<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#6366f1" name="theme-color"/>
<!-- PWA meta tags -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="application-name" content="System HR">
<meta name="format-detection" content="telephone=no">
<!-- Cache control -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>System zarządzania pracownikami - HR & Odzież ochronna (Real-time Sync)</title>

<!-- Firebase SDK v8 (compat) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<style>
/* Import czcionek */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

/* Reset i zmienne CSS */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #6366f1;
    --secondary: #ec4899;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --glass-bg: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-primary: rgba(255, 255, 255, 0.95);
    --text-secondary: rgba(255, 255, 255, 0.7);
}

/* Podstawowe style */
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
}

/* Animacja tła */
.bg-animation {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
    overflow: hidden;
}

.bg-animation span {
    position: absolute;
    display: block;
    width: 100px;
    height: 100px;
    background: linear-gradient(45deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
    animation: animate 25s linear infinite;
    bottom: -150px;
    border-radius: 50%;
}

@keyframes animate {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
    }
}

/* Language Selector */
.language-selector {
    position: fixed;
    top: 1rem;
    left: 1rem;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 0.5rem;
    display: flex;
    gap: 0.5rem;
    z-index: 1001;
}

.lang-btn {
    background: transparent;
    border: 1px solid var(--glass-border);
    color: var(--text-secondary);
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
    font-weight: 500;
}

.lang-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.lang-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* Sync status indicator */
.sync-status {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 50px;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    z-index: 1000;
    transition: all 0.3s ease;
    cursor: pointer;
}

.sync-status:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.sync-status:active {
    transform: scale(0.95);
}

.sync-status::after {
    content: attr(data-tooltip);
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.sync-status:hover::after {
    opacity: 1;
}

.sync-status.syncing {
    background: rgba(251, 191, 36, 0.1);
    border-color: rgba(251, 191, 36, 0.3);
}

.sync-status.synced {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
}

.sync-status.error {
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.3);
}

.sync-status.offline {
    background: rgba(156, 163, 175, 0.1);
    border-color: rgba(156, 163, 175, 0.3);
}

.sync-icon {
    width: 16px;
    height: 16px;
}

.sync-icon.rotating {
    animation: rotate 1s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Navbar */
.navbar {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--glass-border);
    padding: 1rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
}

.nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 1.5rem;
    font-weight: 800;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.tabs {
    display: flex;
    gap: 1rem;
}

.tab {
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-radius: 12px;
    transition: all 0.3s ease;
    font-size: 0.95rem;
    font-weight: 500;
}

.tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
}

.tab.active {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
}

/* Container */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Login Panel */
.login-panel {
    max-width: 400px;
    margin: 4rem auto;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 2rem;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.auth-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.btn-google {
    background: #4285f4;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

.btn-google:hover {
    background: #357ae8;
}

/* Statystyki */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 0.5rem;
}

/* Panel akcji */
.actions-panel {
    margin-bottom: 2rem;
}

.actions-grid {
    display: grid;
    grid-template-columns: 2fr repeat(4, 1fr);
    gap: 1rem;
    align-items: center;
}

/* Wyszukiwarka */
.search-box {
    position: relative;
}

.search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 3rem;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: white;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    -webkit-appearance: none;
    appearance: none;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

.search-input::-webkit-search-cancel-button {
    -webkit-appearance: none;
    appearance: none;
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
}

.clear-search {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    display: none;
    transition: all 0.2s ease;
}

.clear-search:hover {
    color: white;
}

.search-input:not(:placeholder-shown) ~ .clear-search {
    display: block;
}

/* Przyciski */
.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.btn-success {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
}

/* Tabela */
.table-container {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    overflow: hidden;
}

.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    background: rgba(255, 255, 255, 0.03);
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--glass-border);
    cursor: pointer;
    transition: all 0.2s ease;
}

th:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
}

th.sorted-asc::after,
th.sorted-desc::after {
    content: '';
    display: inline-block;
    margin-left: 0.5rem;
    width: 0;
    height: 0;
    border-style: solid;
}

th.sorted-asc::after {
    border-width: 0 4px 6px 4px;
    border-color: transparent transparent var(--primary) transparent;
}

th.sorted-desc::after {
    border-width: 6px 4px 0 4px;
    border-color: var(--primary) transparent transparent transparent;
}

td {
    padding: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

td.editable {
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
}

td.editable:hover {
    background: rgba(255, 255, 255, 0.05);
}

td.editable:hover::after {
    content: '✏️';
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.5;
    font-size: 0.8rem;
}

.edit-input {
    width: 100%;
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid var(--primary);
    border-radius: 8px;
    color: white;
    font-size: 0.9rem;
}

tbody tr {
    transition: all 0.2s ease;
}

tbody tr:hover {
    background: rgba(255, 255, 255, 0.02);
}

.action-btns {
    display: flex;
    gap: 0.5rem;
}

.btn-icon {
    padding: 0.5rem;
    background: transparent;
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-icon:hover {
    transform: scale(1.1);
}

.btn-icon.edit {
    color: var(--primary);
}

.btn-icon.edit:hover {
    background: rgba(99, 102, 241, 0.2);
    border-color: var(--primary);
}

.btn-icon.delete {
    color: var(--danger);
}

.btn-icon.delete:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: var(--danger);
}

.btn-icon.restore {
    color: var(--success);
}

.btn-icon.restore:hover {
    background: rgba(16, 185, 129, 0.2);
    border-color: var(--success);
}

/* Okna modalne */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: linear-gradient(135deg, #2d2d44, #1e1e2e);
    border: 1px solid var(--glass-border);
    margin: 2% auto;
    padding: 0;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    border-radius: 20px;
    animation: slideIn 0.3s ease-out;
    position: relative;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Modal edycji - specjalne style dla pozycjonowania na górze */
#edit-modal .modal-content {
    margin: 1% auto;
    margin-top: 5vh;
}

@keyframes slideIn {
    from {
        transform: translateX(-50%) translateY(-30px) scale(0.95);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) translateY(0) scale(1);
        opacity: 1;
    }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--glass-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    background: rgba(0, 0, 0, 0.2);
}

.modal-title {
    font-size: 1.25rem;
    font-weight: 600;
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

/* Formularz */
form {
    padding: 1.5rem;
    max-height: calc(90vh - 100px);
    overflow-y: auto;
}

/* Zawartość modala działu */
#dept-modal-content {
    padding: 1.5rem;
    max-height: calc(90vh - 100px);
    overflow-y: auto;
}

/* Scrollbar styling */
#dept-modal-content::-webkit-scrollbar,
form::-webkit-scrollbar {
    width: 8px;
}

#dept-modal-content::-webkit-scrollbar-track,
form::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

#dept-modal-content::-webkit-scrollbar-thumb,
form::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
}

#dept-modal-content::-webkit-scrollbar-thumb:hover,
form::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    color: white;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

select.form-input {
    cursor: pointer;
}

select.form-input option {
    background: #2d2d44;
    color: white;
}

textarea.form-input {
    resize: vertical;
    min-height: 100px;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    justify-content: flex-end;
}

/* Toast */
.toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(236, 72, 153, 0.9));
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideInRight 0.3s ease-out;
    z-index: 2000;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Modal działu - lista pracowników */
#dept-modal-content .position-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

#dept-modal-content .position-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

#dept-modal-content .position-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

#dept-modal-content .position-count {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
}

#dept-modal-content .employee-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

#dept-modal-content .employee-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    transition: all 0.2s ease;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#dept-modal-content .employee-item:hover {
    background: rgba(99, 102, 241, 0.1);
    transform: translateX(5px);
    border-color: var(--primary);
}

#dept-modal-content .employee-name {
    font-weight: 500;
    color: white;
}

#dept-modal-content .employee-date {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.6);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
}

.empty-state svg {
    width: 80px;
    height: 80px;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.drop-zone {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(99, 102, 241, 0.95);
    backdrop-filter: blur(10px);
    display: none;
    z-index: 500;
}

.drop-zone.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.drop-zone-content {
    text-align: center;
    color: white;
}

.drop-zone-content svg {
    width: 100px;
    height: 100px;
    margin-bottom: 1rem;
    animation: bounce 1s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-20px);
    }
}

.drop-zone-content h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

/* Auto-save indicator */
.auto-save-indicator {
    position: fixed;
    top: -60px;
    right: 2rem;
    background: rgba(16, 185, 129, 0.9);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0 0 12px 12px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: top 0.3s ease;
    z-index: 1000;
}

.auto-save-indicator.show {
    top: 0;
}

/* Department stats */
.department-stats {
    margin-bottom: 2rem;
}

.dept-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.dept-card {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.dept-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    border-color: var(--primary);
}

.dept-name {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: white;
}

.dept-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.dept-count {
    font-size: 2rem;
    font-weight: 800;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.dept-positions {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.dept-positions-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.position-badge {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* Filtry */
.filters-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-select {
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    color: white !important;
    transition: all 0.3s ease !important;
}

.filter-select:hover {
    background: rgba(255, 255, 255, 0.08) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
}

.filter-select:focus {
    background: rgba(255, 255, 255, 0.1) !important;
    border-color: var(--primary) !important;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2) !important;
}
.date-sort-buttons {
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.sort-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    color: var(--text-secondary);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.9rem;
}

.sort-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border-color: var(--primary);
}

.sort-btn.active {
    background: rgba(99, 102, 241, 0.2);
    color: var(--primary);
    border-color: var(--primary);
}

/* Save instruction */
.save-instruction {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
}

.save-instruction h3 {
    color: white;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.save-instruction p {
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    line-height: 1.6;
}

.save-instruction code {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-family: monospace;
}

/* Mobile specific styles */
.mobile-view {
    display: none;
}

.mobile-fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    border-radius: 50%;
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
}

.mobile-fab:active {
    transform: scale(0.95);
}

.pull-to-refresh {
    position: fixed;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 50%;
    transition: all 0.3s ease;
    z-index: 99;
}

.pull-to-refresh.show {
    top: 20px;
}

.offline-indicator {
    position: fixed;
    bottom: -60px;
    left: 0;
    right: 0;
    background: rgba(239, 68, 68, 0.9);
    color: white;
    padding: 0.75rem;
    text-align: center;
    transition: bottom 0.3s ease;
    z-index: 1000;
}

.offline-indicator.show {
    bottom: 0;
}

.swipe-hint {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-size: 0.85rem;
    display: none;
    z-index: 1000;
}

/* Employee card for mobile */
.employee-card {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.employee-card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.employee-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: white;
}

.employee-position {
    color: var(--primary);
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.card-actions {
    display: flex;
    gap: 0.5rem;
}

.employee-details {
    display: grid;
    gap: 0.75rem;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.detail-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

/* Animacje */
@keyframes slideInLeft {
    from {
        transform: translateX(-100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Settings styles - POPRAWIONE */
.settings-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.settings-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 1.5rem;
}

.settings-title {
    color: white;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.settings-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

.settings-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.settings-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.settings-item input {
    background: transparent;
    border: none;
    color: white;
    font-size: 0.95rem;
    flex: 1;
    padding: 0.25rem;
    border-radius: 5px;
    transition: all 0.2s ease;
}

.settings-item input:focus {
    background: rgba(255, 255, 255, 0.1);
    outline: 1px solid var(--primary);
}

.settings-item-actions {
    display: flex;
    gap: 0.5rem;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.settings-item:hover .settings-item-actions {
    opacity: 1;
}

.settings-add-form {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.settings-add-form input {
    flex: 1;
}

/* Odzież na szkolenie - nowe style */
.training-clothes-display {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 2rem;
    margin-top: 2rem;
}

.employee-info-section {
    display: grid;
    grid-template-columns: 2fr 1fr 1.5fr 1.5fr;
    gap: 2rem;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--glass-border);
}

.info-item {
    text-align: center;
}

.info-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.info-value {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

.clothes-list-section {
    margin-top: 2rem;
}

.clothes-list-title {
    color: white;
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.training-clothes-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.clothes-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 1rem;
    border-radius: 12px;
    font-size: 1.1rem;
    color: white;
    border-left: 4px solid var(--primary);
    transition: all 0.2s ease;
}

.clothes-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

/* Position to clothes mapping in settings */
.position-clothes-mapping {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.mapping-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 1rem;
}

.mapping-position {
    color: white;
    font-weight: 600;
    margin-bottom: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.clothes-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.clothes-tag {
    background: rgba(99, 102, 241, 0.2);
    color: var(--primary);
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.85rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.remove-tag {
    cursor: pointer;
    font-size: 0.75rem;
    color: var(--danger);
    margin-left: 0.25rem;
}

.add-clothes-form {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

/* Loading spinner */
.loading-spinner {
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Media queries */
@media (max-width: 1200px) {
    .actions-grid {
        grid-template-columns: 2fr repeat(3, 1fr);
        gap: 0.75rem;
    }
    
    .actions-grid > * {
        grid-column: auto;
    }
    
    .search-box {
        grid-column: 1 / -1;
    }
}

@media (max-width: 1024px) {
    .employee-info-section {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .actions-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
    
    .search-box {
        grid-column: 1 / -1;
    }
}

@media (max-width: 768px) {
    .language-selector {
        top: 5.5rem;
        left: 1rem;
        padding: 0.3rem;
        gap: 0.3rem;
    }
    
    .lang-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
    }
    
    .sync-status {
        top: 5.5rem;
        right: 1rem;
        padding: 0.4rem 0.8rem;
        font-size: 0.85rem;
    }
    
    .nav-container {
        padding: 0 1rem;
    }
    
    .tabs {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .tab {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
    }
    
    .container {
        padding: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .actions-grid {
        grid-template-columns: 1fr;
    }
    
    .settings-container {
        grid-template-columns: 1fr;
    }
    
    .settings-section {
        min-width: unset;
    }
    
    .table-container {
        display: none;
    }
    
    .mobile-view {
        display: block;
    }
    
    .mobile-fab {
        display: flex;
    }
    
    .modal-content {
        width: 95%;
        margin: 2% auto;
        max-height: 95vh;
    }
    
    #dept-modal-content,
    form {
        max-height: calc(95vh - 80px);
    }
    
    .employee-info-section {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

/* Style dla wydruku - DOSTOSOWANE DO A4 */
@media print {
  /* Reset wszystkich elementów */
  * {
    visibility: hidden !important;
    position: absolute !important;
  }
  
  /* Reset dla html i body */
  html, body {
    visibility: visible !important;
    position: static !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: 100vh !important;
    background: white !important;
    color: black !important;
  }
  
  /* Kontener główny */
  body .container {
    visibility: visible !important;
    position: static !important;
    margin: 0 !important;
    padding: 0 !important;
    max-width: none !important;
    width: 100% !important;
    height: 100% !important;
  }
  
  /* Dla trybu wydawania odzieży */
  body.printing-mode #clothing,
  body.printing-mode #clothing * {
    visibility: visible !important;
    position: static !important;
  }
  
  body.printing-mode #employee-clothing-card {
    display: block !important;
    visibility: visible !important;
    position: static !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: 100vh !important;
  }
  
  body.printing-mode #employee-clothing-card .table-container,
  body.printing-mode #employee-clothing-card .table-container * {
    visibility: visible !important;
    position: static !important;
    background: white !important;
    color: black !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }
  
  body.printing-mode #employee-clothing-card .table-container {
    background: #f0f0f5 !important;
    border: 2px solid #333 !important;
    border-radius: 10px !important;
    padding: 30px 40px !important;
    height: calc(100vh - 2cm) !important;
    margin: 1cm !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* Nagłówek karty */
  body.printing-mode #employee-clothing-card h3 {
    color: black !important;
    font-size: 20pt !important;
    text-align: center !important;
    margin: 0 0 30px 0 !important;
    font-weight: bold !important;
  }
  
  /* Grid z danymi pracownika */
  body.printing-mode #employee-clothing-card .table-container > div:first-child + div {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 15px 30px !important;
    margin-bottom: 30px !important;
  }
  
  /* Etykiety danych */
  body.printing-mode #employee-clothing-card .table-container > div:first-child + div p:first-child {
    color: #666 !important;
    font-size: 10pt !important;
    margin: 0 0 3px 0 !important;
  }
  
  /* Wartości danych */
  body.printing-mode #employee-clothing-card .table-container > div:first-child + div p:last-child {
    color: black !important;
    font-size: 12pt !important;
    font-weight: 600 !important;
    margin: 0 !important;
  }
  
  /* Historia odzieży */
  #clothing-history {
    background: rgba(0, 0, 0, 0.05) !important;
    border: 1px solid #ccc !important;
    border-radius: 5px !important;
    padding: 15px !important;
    margin: 0 0 auto 0 !important;
    min-height: 150px !important;
    max-height: 300px !important;
    overflow-y: auto !important;
    flex-grow: 1 !important;
  }
  
  #clothing-history h4 {
    color: black !important;
    font-size: 12pt !important;
    margin: 0 0 10px 0 !important;
  }
  
  #clothing-history > div {
    background: white !important;
    border: 1px solid #ddd !important;
    border-radius: 5px !important;
    margin-bottom: 10px !important;
    padding: 10px !important;
  }
  
  #clothing-history p {
    font-size: 10pt !important;
    margin: 0 0 5px 0 !important;
  }
  
  /* Ukrycie przycisku usuwania w historii */
  #clothing-history .btn-icon {
    display: none !important;
  }
  
  /* Sekcja podpisów - pokazanie OBIE */
  body.printing-mode #employee-clothing-card .table-container > div:last-child {
    display: block !important;
    visibility: visible !important;
    position: static !important;
    margin-top: auto !important;
    padding-top: 30px !important;
    border-top: 1px solid #000 !important;
  }
  
  body.printing-mode #employee-clothing-card .table-container > div:last-child > div {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 50px !important;
  }
  
  /* Pokazanie OBU podpisów */
  body.printing-mode #employee-clothing-card .table-container > div:last-child > div > div {
    display: block !important;
    visibility: visible !important;
    position: static !important;
    width: 100% !important;
  }
  
  body.printing-mode #employee-clothing-card .table-container > div:last-child > div > div p {
    color: black !important;
    font-size: 11pt !important;
    margin: 0 0 40px 0 !important;
    text-align: left !important;
  }
  
  body.printing-mode #employee-clothing-card .table-container > div:last-child > div > div > div {
    border-bottom: 2px dotted #333 !important;
    height: 1px !important;
    margin: 0 !important;
  }
  
  /* Dla trybu odzieży na szkolenie */
  body.printing-training #training-clothes,
  body.printing-training #training-clothes * {
    visibility: visible !important;
    position: static !important;
  }
  
  body.printing-training #training-clothes-display {
    display: flex !important;
    flex-direction: column !important;
    visibility: visible !important;
    position: static !important;
    background: #f0f0f5 !important;
    color: black !important;
    border: 2px solid #333 !important;
    border-radius: 10px !important;
    padding: 30px 40px !important;
    margin: 1cm !important;
    height: calc(100vh - 2cm) !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }
  
  body.printing-training #training-clothes-display > h3:first-child {
    color: black !important;
    font-size: 20pt !important;
    text-align: center !important;
    margin: 0 0 30px 0 !important;
    font-weight: bold !important;
    text-transform: uppercase !important;
  }
  
  body.printing-training .employee-info-section {
    display: grid !important;
    grid-template-columns: 2fr 1fr 1fr 1fr !important;
    gap: 20px !important;
    margin-bottom: 30px !important;
    padding-bottom: 20px !important;
    border-bottom: 1px solid #ccc !important;
  }
  
  body.printing-training .info-item {
    text-align: left !important;
  }
  
  body.printing-training .info-label {
    color: #666 !important;
    font-size: 10pt !important;
    margin: 0 0 3px 0 !important;
  }
  
  body.printing-training .info-value {
    color: black !important;
    font-size: 12pt !important;
    font-weight: 600 !important;
    margin: 0 !important;
  }
  
  body.printing-training .clothes-list-section {
    flex-grow: 1 !important;
  }
  
  body.printing-training .clothes-list-title {
    color: black !important;
    font-size: 14pt !important;
    font-weight: bold !important;
    margin: 0 0 15px 0 !important;
  }
  
  body.printing-training .training-clothes-list {
    background: rgba(0, 0, 0, 0.05) !important;
    border: 1px solid #ccc !important;
    border-radius: 5px !important;
    padding: 15px !important;
    min-height: 150px !important;
  }
  
  body.printing-training .clothes-item {
    background: white !important;
    border: 1px solid #ddd !important;
    border-left: 4px solid #333 !important;
    padding: 10px !important;
    margin-bottom: 8px !important;
    font-size: 11pt !important;
    color: black !important;
    border-radius: 3px !important;
  }
  
  /* Sekcja podpisów dla odzieży na szkolenie */
  body.printing-training .signature-section {
    display: block !important;
    visibility: visible !important;
    position: static !important;
    margin-top: auto !important;
    padding-top: 30px !important;
    border-top: 1px solid #000 !important;
  }
  
  body.printing-training .signature-section > div {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 50px !important;
  }
  
  /* Pokazanie OBU podpisów */
  body.printing-training .signature-section > div > div {
    display: block !important;
    visibility: visible !important;
    position: static !important;
    width: 100% !important;
  }
  
  body.printing-training .signature-section p {
    color: black !important;
    font-size: 11pt !important;
    margin: 0 0 40px 0 !important;
    text-align: left !important;
  }
  
  body.printing-training .signature-section > div > div > div {
    border-bottom: 2px dotted #333 !important;
    height: 1px !important;
    margin: 0 !important;
  }
  
  /* Ukrycie niepotrzebnych elementów */
  .btn-icon,
  .navbar,
  .language-selector,
  .sync-status,
  .actions-panel,
  .stats-grid,
  .save-instruction,
  .department-stats,
  .filters-section,
  .date-sort-buttons,
  .mobile-fab,
  .pull-to-refresh,
  .offline-indicator,
  .empty-state,
  .close-btn {
    display: none !important;
  }
  
  @page {
    size: A4 portrait;
    margin: 0;
  }
}
</style>
</head>
<body>
<div class="bg-animation">
<span style="left: 10%; animation-delay: 0s;"></span>
<span style="left: 20%; animation-delay: 2s; width: 80px; height: 80px;"></span>
<span style="left: 30%; animation-delay: 4s;"></span>
<span style="left: 40%; animation-delay: 0s; width: 60px; height: 60px;"></span>
<span style="left: 50%; animation-delay: 6s;"></span>
<span style="left: 60%; animation-delay: 8s;"></span>
<span style="left: 70%; animation-delay: 4s; width: 120px; height: 120px;"></span>
<span style="left: 80%; animation-delay: 2s;"></span>
<span style="left: 90%; animation-delay: 1s;"></span>
</div>

<!-- Language Selector -->
<div class="language-selector" id="language-selector">
    <button class="lang-btn active" data-lang="pl" onclick="changeLanguage('pl')">PL</button>
    <button class="lang-btn" data-lang="ua" onclick="changeLanguage('ua')">UA</button>
    <button class="lang-btn" data-lang="en" onclick="changeLanguage('en')">EN</button>
    <button class="lang-btn" data-lang="es" onclick="changeLanguage('es')">ES</button>
</div>

<!-- Sync Status Indicator -->
<div class="sync-status" id="sync-status" onclick="forceDataRefresh()" data-tooltip="Kliknij aby odświeżyć">
    <svg class="sync-icon" id="sync-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
    </svg>
    <span id="sync-text">Offline</span>
</div>

<!-- Login Panel -->
<div id="login-panel" class="login-panel">
    <h2 style="text-align: center; color: white; margin-bottom: 2rem;" data-i18n="login.title">
        System HR - Synchronizacja w czasie rzeczywistym
    </h2>
    <form class="login-form" onsubmit="loginWithEmail(event)">
        <div class="form-group">
            <label class="form-label" data-i18n="login.email">Email</label>
            <input type="email" class="form-input" id="login-email" required>
        </div>
        <div class="form-group">
            <label class="form-label" data-i18n="login.password">Hasło</label>
            <input type="password" class="form-input" id="login-password" required>
        </div>
        <div class="auth-buttons">
            <button type="submit" class="btn btn-primary" data-i18n="login.signIn">Zaloguj się</button>
            <button type="button" class="btn btn-google" onclick="loginWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span data-i18n="login.googleSignIn">Zaloguj przez Google</span>
            </button>
            <button type="button" class="btn" onclick="registerWithEmail()" style="background: rgba(255,255,255,0.1); color: white;">
                <span data-i18n="login.register">Zarejestruj się</span>
            </button>
        </div>
    </form>
    <div style="margin-top: 2rem; text-align: center; color: rgba(255, 255, 255, 0.6); font-size: 0.85rem;">
        <p data-i18n="login.feature1">✨ Synchronizacja w czasie rzeczywistym</p>
        <p data-i18n="login.feature2">📱 Działa na wszystkich urządzeniach</p>
        <p data-i18n="login.feature3">🔒 Bezpieczne przechowywanie danych</p>
    </div>
</div>

<!-- Main App -->
<div id="main-app" style="display: none;">
<nav class="navbar">
<div class="nav-container">
<div class="logo">System HR</div>
<div class="tabs">
<button class="tab active" data-tab="employees" data-i18n="nav.activeEmployees">Aktywni pracownicy</button>
<button class="tab" data-tab="deleted" data-i18n="nav.deletedEmployees">Usunięci pracownicy</button>
<button class="tab" data-tab="clothing" data-i18n="nav.clothingIssue">Wydawanie odzieży</button>
<button class="tab" data-tab="training-clothes" data-i18n="nav.trainingClothes">Odzież na szkolenie</button>
<button class="tab" data-tab="settings">⚙️ <span data-i18n="nav.settings">Ustawienia</span></button>
<button class="tab" onclick="logout()" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">🚪 <span data-i18n="nav.logout">Wyloguj</span></button>
</div>
</div>
</nav>
<div class="container">
<!-- Karta aktywnych pracowników -->
<div class="tab-content active" id="employees">
<div class="stats-grid">
<div class="stat-card">
<div class="stat-number" id="total-employees">0</div>
<div class="stat-label" data-i18n="stats.totalEmployees">Łącznie pracowników</div>
</div>
<div class="stat-card">
<div class="stat-number" id="departments-count">0</div>
<div class="stat-label" data-i18n="stats.departments">Działów</div>
</div>
<div class="stat-card">
<div class="stat-number" id="nationalities-count">0</div>
<div class="stat-label" data-i18n="stats.nationalities">Narodowości</div>
</div>
<div class="stat-card" id="filtered-count-card" style="display: none;">
<div class="stat-number" id="filtered-employees">0</div>
<div class="stat-label" data-i18n="stats.filteredEmployees">Pracowników po filtrowaniu</div>
</div>
<div class="stat-card" id="info-card" style="grid-column: 1 / -1; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(236, 72, 153, 0.2));">
<p style="color: rgba(255, 255, 255, 0.9); font-size: 0.95rem; margin: 0;" data-i18n="info.uploadExcel">
                        💡 Kliknij przycisk "Załaduj Excel" powyżej, aby zaimportować dane z pliku
                    </p>
<p style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin-top: 0.5rem;" data-i18n="info.supportedColumns">
                        Obsługiwane kolumny: Nazwisko,Imię | Stanowisko | Dział | Zmiana | RCP | Obywatelstwo | Szafka | Data przyjęcia
                    </p>
<!-- Додай цей блок десь у розділі Ustawienia або внизу сторінки -->
<div class="settings-section" id="custom-section-container">
  <h3 class="settings-title">
    ➕ Create New Section
  </h3>
  <p style="color: var(--text-secondary); margin-bottom: 1rem;">
    Add custom categories like Buildings, Locations, Certifications, or any other data you need to track
  </p>
  <button class="btn btn-primary" onclick="showNewSectionPrompt()">
    ➕ Add New Section
  </button>
  <ul id="custom-sections-list" class="settings-list" style="margin-top: 1rem;"></ul>
</div>

<script>
let userId = null;

firebase.auth().onAuthStateChanged(user => {
  if (user) {
    userId = user.uid;
    listenForCustomSections();
  }
});

function showNewSectionPrompt() {
  const sectionName = prompt("Enter name of new section:");
  if (!sectionName) return;
  const newRef = firebase.database().ref(`sections/${userId}/customSections`).push();
  newRef.set({ name: sectionName, createdAt: Date.now() });
}

function listenForCustomSections() {
  firebase.database().ref(`sections/${userId}/customSections`).on('value', snapshot => {
    const data = snapshot.val() || {};
    renderCustomSections(data);
  });
}

function renderCustomSections(data) {
  const list = document.getElementById("custom-sections-list");
  list.innerHTML = "";
  Object.entries(data).forEach(([id, item]) => {
    const li = document.createElement("li");
    li.className = "settings-item";
    li.innerHTML = `
      <input type="text" value="${item.name}" onchange="updateCustomSection('${id}', this.value)" />
      <div class="settings-item-actions">
        <button class="btn-icon delete" onclick="deleteCustomSection('${id}')">🗑️</button>
      </div>
    `;
    list.appendChild(li);
  });
  refreshFiltersWithSections(data);
}

function updateCustomSection(id, newName) {
  if (!newName.trim()) return;
  firebase.database().ref(`sections/${userId}/customSections/${id}`).update({ name: newName });
}

function deleteCustomSection(id) {
  if (confirm("Are you sure you want to delete this section?")) {
    firebase.database().ref(`sections/${userId}/customSections/${id}`).remove();
  }
}

function refreshFiltersWithSections(data) {
  const filterSelect = document.getElementById("filter-department");
  if (!filterSelect) return;
  const current = filterSelect.value;
  filterSelect.innerHTML = '<option value="">Wszystkie działy</option>';
  Object.values(data).forEach(sec => {
    const opt = document.createElement("option");
    opt.value = sec.name;
    opt.textContent = sec.name;
    filterSelect.appendChild(opt);
  });
  filterSelect.value = current;
  applyFilters();
}
</script>

</div>
</div>
<!-- Instrukcja zapisywania danych -->

<div class="save-instruction">
<h3>
<svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
<path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
<polyline points="23 4 23 10 17 10"></polyline>
<polyline points="1 20 1 14 7 14"></polyline>
</svg>
<span data-i18n="sync.title">🚀 Synchronizacja w czasie rzeczywistym!</span>
</h3>
<p><strong data-i18n="sync.auto">✅ Automatyczna synchronizacja</strong><br/><span data-i18n="sync.autoDesc">Wszystkie zmiany są natychmiast synchronizowane między urządzeniami</span></p>
<p><strong data-i18n="sync.multi">📱 Multi-urządzenie</strong><br/><span data-i18n="sync.multiDesc">Pracuj na komputerze, tablecie i telefonie jednocześnie</span></p>
<p><strong data-i18n="sync.security">🔒 Bezpieczeństwo</strong><br/><span data-i18n="sync.securityDesc">Dane są bezpiecznie przechowywane w chmurze Firebase</span></p>
<p><strong data-i18n="sync.offline">⚡ Praca offline</strong><br/><span data-i18n="sync.offlineDesc">Aplikacja działa bez internetu - dane zsynchronizują się po połączeniu</span></p>
<p><strong data-i18n="sync.collaboration">👥 Współpraca</strong><br/><span data-i18n="sync.collaborationDesc">Zaloguj się tym samym kontem na różnych urządzeniach</span></p>
<p><strong data-i18n="sync.firebaseRules">🔐 Ważne! Ustaw reguły bezpieczeństwa w Firebase Console:</strong><br/>
Database → Rules → <span data-i18n="sync.changeRules">Zmień na:</span><br/>
<code>{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid"
      }
    }
  }
}</code></p>
<p><strong data-i18n="sync.howItWorks">Jak to działa:</strong><br/>
<span data-i18n="sync.step1">1. Wprowadź zmiany na dowolnym urządzeniu</span><br/>
<span data-i18n="sync.step2">2. Dane automatycznie pojawią się na innych urządzeniach</span><br/>
<span data-i18n="sync.step3">3. Status synchronizacji widoczny w prawym górnym rogu (kliknij aby odświeżyć)</span><br/>
<span data-i18n="sync.step4">4. Brak potrzeby ręcznego zapisywania!</span></p>
</div>

<!-- Statystyki działów -->
<div class="department-stats" id="department-stats" style="display: none;">
<h3 style="color: white; margin-bottom: 1.5rem; font-size: 1.5rem;" data-i18n="departments.statsTitle">📊 Statystyki według działów</h3>
<!-- Ogólna wizualizacja -->
<div class="overall-dept-chart" style="background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 1.5rem; margin-bottom: 2rem;">
<h4 style="color: white; margin-bottom: 1rem;" data-i18n="departments.distribution">Rozkład pracowników według działów</h4>
<div id="dept-distribution-chart"></div>
</div>
<div class="dept-cards-grid" id="dept-cards-grid">
<!-- Karty działów będą tutaj -->
</div>
</div>
<div class="actions-panel">
<div class="filters-section" style="margin-bottom: 1rem;">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
<div class="filter-group">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin-bottom: 0.25rem; display: block;" data-i18n="filters.byDepartment">Filtruj po dziale:</label>
<select class="form-input filter-select" id="filter-department" onchange="applyFilters()" style="padding: 0.5rem; font-size: 0.9rem;">
<option value="" data-i18n="filters.allDepartments">Wszystkie działy</option>
</select>
</div>
<div class="filter-group">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin-bottom: 0.25rem; display: block;" data-i18n="filters.byPosition">Filtruj po stanowisku:</label>
<select class="form-input filter-select" id="filter-position" onchange="applyFilters()" style="padding: 0.5rem; font-size: 0.9rem;">
<option value="" data-i18n="filters.allPositions">Wszystkie stanowiska</option>
</select>
</div>
<div class="filter-group">
<label style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin-bottom: 0.25rem; display: block;" data-i18n="filters.byShift">Filtruj po zmianie:</label>
<select class="form-input filter-select" id="filter-shift" onchange="applyFilters()" style="padding: 0.5rem; font-size: 0.9rem;">
<option value="" data-i18n="filters.allShifts">Wszystkie zmiany</option>
</select>
</div>
</div>
</div>
<div class="date-sort-buttons">
<span style="color: rgba(255, 255, 255, 0.7); margin-right: 1rem;" data-i18n="sort.byHireDate">Sortuj według daty przyjęcia:</span>
<button class="sort-btn" onclick="sortByDateNewest()">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;" viewbox="0 0 24 24" width="16">
<line x1="12" x2="12" y1="19" y2="5"></line>
<polyline points="5 12 12 5 19 12"></polyline>
</svg>
                        <span data-i18n="sort.newest">Najnowsi</span>
                    </button>
<button class="sort-btn" onclick="sortByDateOldest()">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;" viewbox="0 0 24 24" width="16">
<line x1="12" x2="12" y1="5" y2="19"></line>
<polyline points="19 12 12 19 5 12"></polyline>
</svg>
                        <span data-i18n="sort.oldest">Najstarsi</span>
                    </button>
</div>
<div class="actions-grid" style="grid-template-columns: 2fr repeat(7, 1fr);">
<div class="search-box">
<svg class="search-icon" fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<circle cx="11" cy="11" r="8"></circle>
<path d="m21 21-4.35-4.35"></path>
</svg>
<input class="search-input" id="search" placeholder="Szukaj pracowników..." type="search" autocomplete="off" data-i18n-placeholder="search.employees"/>
<button class="clear-search" onclick="clearSearch()" type="button">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<line x1="18" y1="6" x2="6" y2="18"></line>
<line x1="6" y1="6" x2="18" y2="18"></line>
</svg>
</button>
</div>
<button class="btn btn-primary" onclick="openAddModal()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                        <span data-i18n="buttons.addEmployee">Dodaj pracownika</span>
                    </button>
<label class="btn btn-success" onclick="console.log('Excel button clicked')">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" x2="12" y1="15" y2="3"></line>
</svg>
                        <span data-i18n="buttons.loadExcel">Załaduj Excel</span>
                        <input accept=".xlsx,.xls" id="file-input" style="display: none;" type="file" onchange="console.log('File input changed:', this.files)"/>
</label>
<button class="btn" onclick="exportToExcel()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
<line x1="16" x2="8" y1="13" y2="13"></line>
<line x1="16" x2="8" y1="17" y2="17"></line>
<polyline points="10 9 9 9 8 9"></polyline>
</svg>
                        <span data-i18n="buttons.exportExcel">Eksport Excel</span>
                    </button>
<button class="btn" onclick="exportToJSON()" style="background: linear-gradient(135deg, #ec4899, #db2777); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
<polyline points="17 21 17 13 7 13 7 21"></polyline>
<polyline points="7 3 7 8 15 8"></polyline>
</svg>
                        <span data-i18n="buttons.backupJSON">Backup JSON</span>
                    </button>
<button class="btn" onclick="createSampleExcel()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
<line x1="12" x2="12" y1="18" y2="12"></line>
<line x1="9" x2="15" y1="15" y2="15"></line>
</svg>
                        <span data-i18n="buttons.sampleExcel">Przykład Excel</span>
                    </button>
<label class="btn" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" x2="12" y1="15" y2="3"></line>
</svg>
                        <span data-i18n="buttons.importJSON">Import JSON</span>
                        <input accept=".json" onchange="if(this.files.length > 0) importFromJSON(this.files[0])" style="display: none;" type="file"/>
</label>
<button class="btn" onclick="clearAllEmployees()" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;" title="Usuń wszystkich pracowników">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<polyline points="3 6 5 6 21 6"></polyline>
<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
<line x1="10" x2="10" y1="11" y2="17"></line>
<line x1="14" x2="14" y1="11" y2="17"></line>
</svg>
                        <span data-i18n="buttons.clearList">Wyczyść listę</span>
                    </button>
</div>
</div>
<div class="table-container">
<div class="table-wrapper">
<table id="employees-table">
<thead>
<tr>
<th onclick="sortEmployees('name')" data-i18n="table.name">Nazwisko, Imię</th>
<th onclick="sortEmployees('position')" data-i18n="table.position">Stanowisko</th>
<th onclick="sortEmployees('department')" data-i18n="table.department">Dział</th>
<th onclick="sortEmployees('shift')" data-i18n="table.shift">Zmiana</th>
<th onclick="sortEmployees('rcp')" data-i18n="table.rcp">RCP</th>
<th onclick="sortEmployees('citizenship')" data-i18n="table.citizenship">Obywatelstwo</th>
<th onclick="sortEmployees('locker')" data-i18n="table.locker">Szafka</th>
<th onclick="sortEmployees('hireDate')" data-i18n="table.hireDate">Data przyjęcia</th>
<th data-i18n="table.actions">Akcje</th>
</tr>
</thead>
<tbody id="employees-tbody">
</tbody>
</table>
</div>
<div style="padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0 0 20px 20px;">
<p style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin: 0; text-align: center;" data-i18n="table.editHint">
                        💡 Wskazówka: Kliknij na dowolną komórkę w tabeli, aby edytować dane bezpośrednio
                    </p>
</div>
</div>
<!-- Mobilny widok kart -->
<div class="mobile-view">
<div class="mobile-cards" id="mobile-cards">
<!-- Karty pracowników będą tutaj -->
</div>
</div>
</div>
<!-- Karta usuniętych pracowników -->
<div class="tab-content" id="deleted">
<div class="actions-panel">
    <button class="btn btn-primary" onclick="openAddDeletedModal()" style="margin-bottom: 1rem;">
        <svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
            <line x1="12" x2="12" y1="5" y2="19"></line>
            <line x1="5" x2="19" y1="12" y2="12"></line>
        </svg>
        <span data-i18n="buttons.addDeletedEmployee">Dodaj usuniętego pracownika</span>
    </button>
</div>
<div class="date-sort-buttons" style="margin: 1rem 0;">
<span style="color: rgba(255, 255, 255, 0.7); margin-right: 1rem;" data-i18n="sort.byDeleteDate">Sortuj według daty usunięcia:</span>
<button class="sort-btn" onclick="sortDeletedByDateNewest()">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;" viewbox="0 0 24 24" width="16">
<line x1="12" x2="12" y1="19" y2="5"></line>
<polyline points="5 12 12 5 19 12"></polyline>
</svg>
                    <span data-i18n="sort.newest">Najnowsi</span>
                </button>
<button class="sort-btn" onclick="sortDeletedByDateOldest()">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;" viewbox="0 0 24 24" width="16">
<line x1="12" x2="12" y1="5" y2="19"></line>
<polyline points="19 12 12 19 5 12"></polyline>
</svg>
                    <span data-i18n="sort.oldest">Najstarsi</span>
                </button>
</div>
<div class="table-container">
<div class="table-wrapper">
<table id="deleted-table">
<thead>
<tr>
<th data-i18n="table.name">Nazwisko, Imię</th>
<th data-i18n="table.position">Stanowisko</th>
<th data-i18n="table.department">Dział</th>
<th data-i18n="table.shift">Zmiana</th>
<th data-i18n="table.rcp">RCP</th>
<th data-i18n="table.citizenship">Obywatelstwo</th>
<th data-i18n="table.deleteDate">Data usunięcia</th>
<th data-i18n="table.actions">Akcje</th>
</tr>
</thead>
<tbody id="deleted-tbody">
</tbody>
</table>
</div>
<div class="empty-state" id="deleted-empty" style="display: none;">
<svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24">
<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
<polyline points="16 17 21 12 16 7"></polyline>
<line x1="21" x2="9" y1="12" y2="12"></line>
</svg>
<p data-i18n="empty.deletedEmployees">Brak usuniętych pracowników</p>
</div>
</div>
<!-- Mobilny widok kart dla usuniętych -->
<div class="mobile-view">
<div class="mobile-cards" id="deleted-mobile-cards">
<!-- Karty usuniętych pracowników będą tutaj -->
</div>
</div>
</div>
<!-- Karta wydawania odzieży -->
<div class="tab-content" id="clothing">
<div class="stats-grid">
<div class="stat-card" style="grid-column: 1 / -1;">
<h3 style="color: white; margin-bottom: 1rem; font-size: 1.5rem;" data-i18n="clothing.title">📦 System wydawania odzieży ochronnej</h3>
<p style="color: rgba(255, 255, 255, 0.7); margin: 0;" data-i18n="clothing.description">
                        Wybierz pracownika z listy aby wydać lub sprawdzić historię wydanej odzieży
                    </p>
</div>
</div>
<div class="actions-panel">
<div class="actions-grid" style="grid-template-columns: 1fr auto auto;">
<div class="form-group" style="margin: 0;">
<select class="form-input" id="clothing-employee-select" onchange="loadEmployeeClothingData()" style="width: 100%;">
<option value="" data-i18n="select.employee">Wybierz pracownika...</option>
</select>
</div>
<button class="btn btn-primary" onclick="openClothingIssueModal()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M12 2L2 7l10 5 10-5-10-5z"></path>
<path d="M2 17l10 5 10-5"></path>
<path d="M2 12l10 5 10-5"></path>
</svg>
                        <span data-i18n="buttons.issueClothing">Wydaj odzież</span>
                    </button>
<button class="btn" onclick="printClothingRecord()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<polyline points="6 9 6 2 18 2 18 9"></polyline>
<path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
<rect height="8" width="12" x="6" y="14"></rect>
</svg>
                        <span data-i18n="buttons.printCard">Drukuj kartę</span>
                    </button>
</div>
</div>
<!-- Karta pracownika -->
<div id="employee-clothing-card" style="display: none;">
<div class="table-container" style="background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem;">
<h3 style="color: white; margin-bottom: 1.5rem; text-align: center; font-size: 1.8rem;" data-i18n="clothing.cardTitle">Karta wydania odzieży ochronnej</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 0.5rem;" data-i18n="fields.nameLabel">Nazwisko, Imię:</p>
<p id="clothing-employee-name" style="color: white; font-size: 1.2rem; font-weight: 600;">-</p>
</div>
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 0.5rem;" data-i18n="fields.positionLabel">Stanowisko:</p>
<p id="clothing-employee-position" style="color: white; font-size: 1.2rem;">-</p>
</div>
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 0.5rem;" data-i18n="fields.departmentLabel">Dział:</p>
<p id="clothing-employee-department" style="color: white; font-size: 1.2rem;">-</p>
</div>
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 0.5rem;" data-i18n="clothing.lastIssueDate">Ostatnio pobrana odzież dnia:</p>
<p id="clothing-last-issue-date" style="color: white; font-size: 1.2rem;">-</p>
</div>
</div>
<div style="margin-bottom: 2rem;">
<h4 style="color: white; margin-bottom: 1rem;" data-i18n="clothing.history">Historia wydanej odzieży:</h4>
<div id="clothing-history" style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1rem;">
<p style="color: rgba(255, 255, 255, 0.5); text-align: center;" data-i18n="clothing.noHistory">Brak historii wydawania</p>
</div>
</div>
<div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2);">
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem;" data-i18n="signature.employee">Podpis pracownika:</p>
<div style="border-bottom: 2px dotted rgba(255, 255, 255, 0.3); height: 40px;"></div>
</div>
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem;" data-i18n="signature.issuer">Podpis wydającego:</p>
<div style="border-bottom: 2px dotted rgba(255, 255, 255, 0.3); height: 40px;"></div>
</div>
</div>
</div>
</div>
</div>
<!-- Mobilny widok -->
<div class="mobile-view">
<div id="employee-clothing-card-mobile" style="display: none;">
<div class="employee-card">
<h4 style="color: white; text-align: center; margin-bottom: 1rem;" data-i18n="clothing.cardTitle">Karta wydania odzieży</h4>
<div class="employee-details">
<div class="detail-row">
<span class="detail-label" data-i18n="fields.employee">Pracownik:</span>
<span id="clothing-employee-name-mobile">-</span>
</div>
<div class="detail-row">
<span class="detail-label" data-i18n="fields.positionLabel">Stanowisko:</span>
<span id="clothing-employee-position-mobile">-</span>
</div>
<div class="detail-row">
<span class="detail-label" data-i18n="fields.departmentLabel">Dział:</span>
<span id="clothing-employee-department-mobile">-</span>
</div>
<div class="detail-row">
<span class="detail-label" data-i18n="clothing.lastIssue">Ostatnie wydanie:</span>
<span id="clothing-last-issue-date-mobile">-</span>
</div>
</div>
<div style="margin-top: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
<p id="clothing-history-mobile" style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; margin: 0;" data-i18n="clothing.noHistory">
                                Brak historii wydawania
                            </p>
</div>
</div>
</div>
</div>
</div>
<!-- Karta Odzież na szkolenie - NOWA FUNKCJONALNOŚĆ -->
<div class="tab-content" id="training-clothes">
<div class="stats-grid">
<div class="stat-card" style="grid-column: 1 / -1;">
<h3 style="color: white; margin-bottom: 1rem; font-size: 1.5rem;" data-i18n="training.title">🎓 Odzież na szkolenie</h3>
<p style="color: rgba(255, 255, 255, 0.7); margin: 0;" data-i18n="training.description">
                        Wybierz pracownika z listy, aby zobaczyć przypisaną odzież na szkolenie dla jego stanowiska
                    </p>
</div>
</div>
<div class="actions-panel">
<div class="actions-grid" style="grid-template-columns: 1fr auto;">
<div class="form-group" style="margin: 0;">
<select class="form-input" id="training-employee-select" onchange="loadTrainingClothes()" style="width: 100%;">
<option value="" data-i18n="select.employee">Wybierz pracownika...</option>
</select>
</div>
<button class="btn" onclick="printTrainingClothes()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<polyline points="6 9 6 2 18 2 18 9"></polyline>
<path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
<rect height="8" width="12" x="6" y="14"></rect>
</svg>
                        <span data-i18n="buttons.printCard">Drukuj kartę</span>
                    </button>
</div>
</div>
<!-- Wyświetlanie danych pracownika i odzieży -->
<div id="training-clothes-display" class="training-clothes-display" style="display: none;">
<h3 style="color: white; text-align: center; font-size: 1.8rem; margin-bottom: 2rem;" data-i18n="training.cardTitle">Karta odzieży na szkolenie</h3>
<div class="employee-info-section">
<div class="info-item">
<p class="info-label" data-i18n="fields.nameLabel">Nazwisko, Imię:</p>
<p class="info-value" id="training-employee-name">-</p>
</div>
<div class="info-item">
<p class="info-label" data-i18n="fields.rcpLabel">RCP:</p>
<p class="info-value" id="training-employee-rcp">-</p>
</div>
<div class="info-item">
<p class="info-label" data-i18n="fields.positionLabel">Stanowisko:</p>
<p class="info-value" id="training-employee-position">-</p>
</div>
<div class="info-item">
<p class="info-label" data-i18n="fields.departmentLabel">Dział:</p>
<p class="info-value" id="training-employee-department">-</p>
</div>
</div>
<div class="clothes-list-section">
<h3 class="clothes-list-title" data-i18n="training.issuedClothing">Wydana odzież</h3>
<div class="training-clothes-list" id="training-clothes-list">
<!-- Lista odzieży będzie tutaj -->
</div>
</div>
<div class="signature-section" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2); display: none;">
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem;" data-i18n="signature.employee">Podpis pracownika:</p>
<div style="border-bottom: 2px dotted rgba(255, 255, 255, 0.3); height: 40px;"></div>
</div>
<div>
<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem;" data-i18n="signature.issuer">Podpis wydającego:</p>
<div style="border-bottom: 2px dotted rgba(255, 255, 255, 0.3); height: 40px;"></div>
</div>
</div>
</div>
</div>
</div>
<!-- Karta ustawień - POPRAWIONA -->
<div class="tab-content" id="settings">
<div class="stats-grid">
<div class="stat-card" style="grid-column: 1 / -1;">
<h3 style="color: white; margin-bottom: 1rem; font-size: 1.5rem;" data-i18n="settings.title">⚙️ Zarządzanie listami systemowymi</h3>
<p style="color: rgba(255, 255, 255, 0.7); margin: 0;" data-i18n="settings.description">
                        Tutaj możesz dodawać, edytować i usuwać elementy list używanych w systemie
                    </p>
</div>
</div>
<div class="settings-container">
<!-- Działy -->
<div class="settings-section">
<h3 class="settings-title" data-i18n="settings.departments">📁 Działy</h3>
<div class="settings-list" id="departments-list">
<!-- Lista działów będzie tutaj -->
</div>
<div class="settings-add-form">
<input class="form-input" id="new-department" placeholder="Nazwa nowego działu..." type="text" data-i18n-placeholder="settings.newDepartment"/>
<button class="btn btn-primary" onclick="addDepartment()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                            <span data-i18n="buttons.addDepartment">Dodaj dział</span>
                        </button>
</div>
</div>
<!-- Stanowiska -->
<div class="settings-section">
<h3 class="settings-title" data-i18n="settings.positions">👷 Stanowiska</h3>
<div class="settings-list" id="positions-list">
<!-- Lista stanowisk będzie tutaj -->
</div>
<div class="settings-add-form">
<input class="form-input" id="new-position" placeholder="Nazwa nowego stanowiska..." type="text" data-i18n-placeholder="settings.newPosition"/>
<button class="btn btn-primary" onclick="addPosition()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                            <span data-i18n="buttons.addPosition">Dodaj stanowisko</span>
                        </button>
</div>
</div>
<!-- Zmiany/Kierownicy -->
<div class="settings-section">
<h3 class="settings-title" data-i18n="settings.shifts">👥 Zmiany/Kierownicy</h3>
<div class="settings-list" id="shifts-list">
<!-- Lista zmian będzie tutaj -->
</div>
<div class="settings-add-form">
<input class="form-input" id="new-shift" placeholder="Nazwa zmiany lub kierownika..." type="text" data-i18n-placeholder="settings.newShift"/>
<button class="btn btn-primary" onclick="addShift()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                            <span data-i18n="buttons.addShift">Dodaj zmianę</span>
                        </button>
</div>
</div>
<!-- Obywatelstwa -->
<div class="settings-section">
<h3 class="settings-title" data-i18n="settings.citizenships">🌍 Obywatelstwa</h3>
<div class="settings-list" id="citizenships-list">
<!-- Lista obywatelstw będzie tutaj -->
</div>
<div class="settings-add-form">
<input class="form-input" id="new-citizenship" placeholder="Nazwa obywatelstwa..." type="text" data-i18n-placeholder="settings.newCitizenship"/>
<button class="btn btn-primary" onclick="addCitizenship()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                            <span data-i18n="buttons.addCitizenship">Dodaj obywatelstwo</span>
                        </button>
</div>
</div>
<!-- Elementy odzieży -->
<div class="settings-section">
<h3 class="settings-title" data-i18n="settings.clothingItems">👔 Elementy odzieży ochronnej</h3>
<div class="settings-list" id="clothing-items-list">
<!-- Lista odzieży będzie tutaj -->
</div>
<div class="settings-add-form">
<input class="form-input" id="new-clothing-item" placeholder="Nazwa elementu odzieży..." type="text" data-i18n-placeholder="settings.newClothingItem"/>
<button class="btn btn-primary" onclick="addClothingItem()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
                            <span data-i18n="buttons.addClothingItem">Dodaj element</span>
                        </button>
</div>
</div>
<!-- Odzież na szkolenie - przypisanie do stanowisk -->
<div class="settings-section" style="grid-column: 1 / -1;">
<h3 class="settings-title" data-i18n="settings.trainingClothesMapping">🎓 Przypisanie odzieży na szkolenie do stanowisk</h3>
<div class="position-clothes-mapping" id="position-clothes-mapping">
<!-- Mapowanie stanowisk do odzieży będzie tutaj -->
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Okno modalne dodawania pracownika -->
<div class="modal" id="add-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" data-i18n="modal.addEmployee">Dodaj nowego pracownika</h2>
<button class="close-btn" onclick="closeAddModal()">×</button>
</div>
<form id="add-form" onsubmit="addEmployee(event)">
<div class="form-group">
<label class="form-label" data-i18n="fields.nameLabel">Nazwisko, Imię</label>
<input class="form-input" name="name" placeholder="KOWALSKI JAN" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.positionLabel">Stanowisko</label>
<input class="form-input" list="position-list" name="position" placeholder="Wybierz lub wpisz nowe stanowisko" required="" type="text" data-i18n-placeholder="fields.positionPlaceholder"/>
<datalist id="position-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.departmentLabel">Dział</label>
<select class="form-input" id="department-select" name="department" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
<input class="form-input" id="department-other" name="department-other" placeholder="Wpisz nazwę działu" style="display: none; margin-top: 0.5rem;" type="text" data-i18n-placeholder="fields.departmentOther"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.shiftLabel">Zmiana/Kierownik</label>
<input class="form-input" list="shift-list" name="shift" placeholder="Wybierz lub wpisz" type="text" data-i18n-placeholder="fields.shiftPlaceholder"/>
<datalist id="shift-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.rcpLabel">RCP</label>
<input class="form-input" name="rcp" placeholder="5286" type="number"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.citizenshipLabel">Obywatelstwo</label>
<select class="form-input" id="citizenship-select" name="citizenship" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
<input class="form-input" id="citizenship-other" name="citizenship-other" placeholder="Wpisz obywatelstwo" style="display: none; margin-top: 0.5rem;" type="text" data-i18n-placeholder="fields.citizenshipOther"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.lockerLabel">Szafka</label>
<input class="form-input" list="locker-list" name="locker" placeholder="K92" type="text"/>
<datalist id="locker-list">
<option value="K">
<option value="M">
<option value="Q">
</option></option></option></datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.hireDateLabel">Data przyjęcia</label>
<input class="form-input" name="hireDate" type="date" value=""/>
</div>
<div class="form-actions">
<button class="btn" onclick="closeAddModal()" style="background: rgba(255,255,255,0.1); color: white;" type="button" data-i18n="buttons.cancel">Anuluj</button>
<button class="btn btn-primary" type="submit" data-i18n="buttons.addEmployee">Dodaj pracownika</button>
</div>
</form>
</div>
</div>

<!-- Okno modalne dodawania usuniętego pracownika -->
<div class="modal" id="add-deleted-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" data-i18n="modal.addDeletedEmployee">Dodaj usuniętego pracownika</h2>
<button class="close-btn" onclick="closeAddDeletedModal()">×</button>
</div>
<form id="add-deleted-form" onsubmit="addDeletedEmployee(event)">
<div class="form-group">
<label class="form-label" data-i18n="fields.nameLabel">Nazwisko, Imię</label>
<input class="form-input" name="name" placeholder="KOWALSKI JAN" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.positionLabel">Stanowisko</label>
<input class="form-input" list="deleted-position-list" name="position" placeholder="Wybierz lub wpisz stanowisko" required="" type="text" data-i18n-placeholder="fields.positionPlaceholder"/>
<datalist id="deleted-position-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.departmentLabel">Dział</label>
<select class="form-input" id="deleted-department-select" name="department" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.shiftLabel">Zmiana/Kierownik</label>
<input class="form-input" list="deleted-shift-list" name="shift" placeholder="Wybierz lub wpisz" type="text" data-i18n-placeholder="fields.shiftPlaceholder"/>
<datalist id="deleted-shift-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.rcpLabel">RCP</label>
<input class="form-input" name="rcp" placeholder="5286" type="number"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.citizenshipLabel">Obywatelstwo</label>
<select class="form-input" id="deleted-citizenship-select" name="citizenship" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.deleteDateLabel">Data usunięcia</label>
<input class="form-input" name="deletedDate" type="date" value="" required/>
</div>
<div class="form-actions">
<button class="btn" onclick="closeAddDeletedModal()" style="background: rgba(255,255,255,0.1); color: white;" type="button" data-i18n="buttons.cancel">Anuluj</button>
<button class="btn btn-primary" type="submit" data-i18n="buttons.addDeletedEmployee">Dodaj usuniętego pracownika</button>
</div>
</form>
</div>
</div>
<!-- Okno modalne edycji pracownika -->
<div class="modal" id="edit-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" data-i18n="modal.editEmployee">Edytuj pracownika</h2>
<button class="close-btn" onclick="closeEditModal()">×</button>
</div>
<form id="edit-form" onsubmit="saveEmployee(event)">
<input id="edit-employee-id" type="hidden"/>
<div class="form-group">
<label class="form-label" data-i18n="fields.nameLabel">Nazwisko, Imię</label>
<input class="form-input" id="edit-name" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.positionLabel">Stanowisko</label>
<input class="form-input" id="edit-position" list="edit-position-list" required="" type="text"/>
<datalist id="edit-position-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.departmentLabel">Dział</label>
<select class="form-input" id="edit-department" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
<input class="form-input" id="edit-department-other" placeholder="Wpisz nazwę działu" style="display: none; margin-top: 0.5rem;" type="text" data-i18n-placeholder="fields.departmentOther"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.shiftLabel">Zmiana/Kierownik</label>
<input class="form-input" id="edit-shift" list="edit-shift-list" type="text"/>
<datalist id="edit-shift-list">
<!-- Opcje będą generowane dynamicznie -->
</datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.rcpLabel">RCP</label>
<input class="form-input" id="edit-rcp" type="number"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.citizenshipLabel">Obywatelstwo</label>
<select class="form-input" id="edit-citizenship" required="">
<!-- Opcje będą generowane dynamicznie -->
</select>
<input class="form-input" id="edit-citizenship-other" placeholder="Wpisz obywatelstwo" style="display: none; margin-top: 0.5rem;" type="text" data-i18n-placeholder="fields.citizenshipOther"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.lockerLabel">Szafka</label>
<input class="form-input" id="edit-locker" list="edit-locker-list" type="text"/>
<datalist id="edit-locker-list">
<option value="K">
<option value="M">
<option value="Q">
</option></option></option></datalist>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.hireDateLabel">Data przyjęcia</label>
<input class="form-input" id="edit-hireDate" type="date"/>
</div>
<div class="form-actions">
<button class="btn" onclick="closeEditModal()" style="background: rgba(255,255,255,0.1); color: white;" type="button" data-i18n="buttons.cancel">Anuluj</button>
<button class="btn btn-primary" type="submit" data-i18n="buttons.saveChanges">Zapisz zmiany</button>
</div>
</form>
</div>
</div>
<!-- Okno modalne szczegółów działu -->
<div class="modal" id="dept-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="dept-modal-title">Szczegóły działu</h2>
<button class="close-btn" onclick="closeDeptModal()">×</button>
</div>
<div id="dept-modal-content">
<!-- Szczegóły działu będą tutaj -->
</div>
</div>
</div>
<!-- Okno modalne wydawania odzieży -->
<div class="modal" id="clothing-issue-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" data-i18n="modal.issueClothing">Wydaj odzież ochronną</h2>
<button class="close-btn" onclick="closeClothingIssueModal()">×</button>
</div>
<form id="clothing-issue-form" onsubmit="issueClothing(event)">
<div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1rem; margin-bottom: 1.5rem;">
<p style="color: white; margin: 0;">
<strong data-i18n="fields.employee">Pracownik:</strong> <span id="modal-employee-name">-</span><br/>
<strong data-i18n="fields.departmentLabel">Dział:</strong> <span id="modal-employee-department">-</span><br/>
<strong data-i18n="fields.positionLabel">Stanowisko:</strong> <span id="modal-employee-position">-</span>
</p>
</div>
<div class="form-group">
<label class="form-label" data-i18n="clothing.issueDate">Data wydania:</label>
<input class="form-input" name="issueDate" required="" type="date"/>
</div>
<div class="form-group">
<label class="form-label" data-i18n="clothing.selectItems">Wybierz wydawane elementy:</label>
<div id="clothing-checkboxes" style="display: grid; gap: 1rem;">
<!-- Checkboxy będą generowane dynamicznie -->
</div>
</div>
<div class="form-group">
<label class="form-label" data-i18n="fields.notes">Uwagi (opcjonalne):</label>
<textarea class="form-input" name="notes" placeholder="Dodatkowe informacje..." rows="3" data-i18n-placeholder="fields.notesPlaceholder"></textarea>
</div>
<div class="form-actions">
<button class="btn" onclick="closeClothingIssueModal()" style="background: rgba(255,255,255,0.1); color: white;" type="button" data-i18n="buttons.cancel">Anuluj</button>
<button class="btn btn-primary" type="submit" data-i18n="buttons.issueClothing">Wydaj odzież</button>
</div>
</form>
</div>
</div>
<!-- Strefa upuszczania -->
<div class="drop-zone" id="drop-zone">
<div class="drop-zone-content">
<svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" x2="12" y1="15" y2="3"></line>
</svg>
<h2 data-i18n="dropzone.title">Przeciągnij plik Excel tutaj</h2>
<p data-i18n="dropzone.formats">Obsługiwane formaty .xlsx i .xls</p>
</div>
</div>
<!-- Wskaźnik auto-zapisu -->
<div class="auto-save-indicator" id="auto-save-indicator">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<polyline points="20 6 9 17 4 12"></polyline>
</svg>
<span data-i18n="misc.dataSaved">Dane zapisane</span>
</div>
<!-- Przycisk FAB dla mobilnych -->
<button class="mobile-fab" onclick="showMobileMenu()">
<svg fill="none" height="24" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="24">
<line x1="12" x2="12" y1="5" y2="19"></line>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
</button>
<!-- Pull to refresh -->
<div class="pull-to-refresh" id="pull-to-refresh">
<svg fill="none" height="24" stroke="#6366f1" stroke-width="2" viewbox="0 0 24 24" width="24">
<polyline points="23 4 23 10 17 10"></polyline>
<polyline points="1 20 1 14 7 14"></polyline>
<path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
</svg>
</div>
<!-- Wskaźnik offline -->
<div class="offline-indicator" id="offline-indicator">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;" viewbox="0 0 24 24" width="16">
<line x1="1" x2="23" y1="1" y2="23"></line>
<path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path>
<path d="M17 17.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path>
<line x1="12" x2="12" y1="19" y2="23"></line>
<line x1="8" x2="16" y1="23" y2="23"></line>
</svg>
        <span data-i18n="misc.offline">Brak połączenia z internetem - pracujesz offline</span>
    </div>
<!-- Podpowiedź swipe -->
<div class="swipe-hint" id="swipe-hint" data-i18n="misc.swipeHint">
        Przesuń w lewo lub prawo aby zmienić zakładkę
    </div>
<!-- XLSX Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
        // ==============================================
        // TRANSLATIONS
        // ==============================================
        const translations = {
            pl: {
                // Login
                'login.title': 'System HR - Synchronizacja w czasie rzeczywistym',
                'login.email': 'Email',
                'login.password': 'Hasło',
                'login.signIn': 'Zaloguj się',
                'login.googleSignIn': 'Zaloguj przez Google',
                'login.register': 'Zarejestruj się',
                'login.feature1': '✨ Synchronizacja w czasie rzeczywistym',
                'login.feature2': '📱 Działa na wszystkich urządzeniach',
                'login.feature3': '🔒 Bezpieczne przechowywanie danych',
                
                // Navigation
                'nav.activeEmployees': 'Aktywni pracownicy',
                'nav.deletedEmployees': 'Usunięci pracownicy',
                'nav.clothingIssue': 'Wydawanie odzieży',
                'nav.trainingClothes': 'Odzież na szkolenie',
                'nav.settings': 'Ustawienia',
                'nav.logout': 'Wyloguj',
                
                // Stats
                'stats.totalEmployees': 'Łącznie pracowników',
                'stats.departments': 'Działów',
                'stats.nationalities': 'Narodowości',
                'stats.filteredEmployees': 'Pracowników po filtrowaniu',
                
                // Info
                'info.uploadExcel': '💡 Kliknij przycisk "Załaduj Excel" powyżej, aby zaimportować dane z pliku',
                'info.supportedColumns': 'Obsługiwane kolumny: Nazwisko,Imię | Stanowisko | Dział | Zmiana | RCP | Obywatelstwo | Szafka | Data przyjęcia',
                
                // Sync
                'sync.title': '🚀 Synchronizacja w czasie rzeczywistym!',
                'sync.auto': '✅ Automatyczna synchronizacja',
                'sync.autoDesc': 'Wszystkie zmiany są natychmiast synchronizowane między urządzeniami',
                'sync.multi': '📱 Multi-urządzenie',
                'sync.multiDesc': 'Pracuj na komputerze, tablecie i telefonie jednocześnie',
                'sync.security': '🔒 Bezpieczeństwo',
                'sync.securityDesc': 'Dane są bezpiecznie przechowywane w chmurze Firebase',
                'sync.offline': '⚡ Praca offline',
                'sync.offlineDesc': 'Aplikacja działa bez internetu - dane zsynchronizują się po połączeniu',
                'sync.collaboration': '👥 Współpraca',
                'sync.collaborationDesc': 'Zaloguj się tym samym kontem na różnych urządzeniach',
                'sync.firebaseRules': '🔐 Ważne! Ustaw reguły bezpieczeństwa w Firebase Console:',
                'sync.changeRules': 'Zmień na:',
                'sync.howItWorks': 'Jak to działa:',
                'sync.step1': '1. Wprowadź zmiany na dowolnym urządzeniu',
                'sync.step2': '2. Dane automatycznie pojawią się na innych urządzeniach',
                'sync.step3': '3. Status synchronizacji widoczny w prawym górnym rogu (kliknij aby odświeżyć)',
                'sync.step4': '4. Brak potrzeby ręcznego zapisywania!',
                
                // Departments
                'departments.statsTitle': '📊 Statystyki według działów',
                'departments.distribution': 'Rozkład pracowników według działów',
                'departments.employeeCount': 'Liczba pracowników:',
                'departments.positions': 'stanowisk',
                
                // Filters
                'filters.byDepartment': 'Filtruj po dziale:',
                'filters.allDepartments': 'Wszystkie działy',
                'filters.byPosition': 'Filtruj po stanowisku:',
                'filters.allPositions': 'Wszystkie stanowiska',
                'filters.byShift': 'Filtruj po zmianie:',
                'filters.allShifts': 'Wszystkie zmiany',
                
                // Sort
                'sort.byHireDate': 'Sortuj według daty przyjęcia:',
                'sort.byDeleteDate': 'Sortuj według daty usunięcia:',
                'sort.newest': 'Najnowsi',
                'sort.oldest': 'Najstarsi',
                
                // Search
                'search.employees': 'Szukaj pracowników...',
                
                // Buttons
                'buttons.addEmployee': 'Dodaj pracownika',
                'buttons.loadExcel': 'Załaduj Excel',
                'buttons.exportExcel': 'Eksport Excel',
                'buttons.backupJSON': 'Backup JSON',
                'buttons.sampleExcel': 'Przykład Excel',
                'buttons.importJSON': 'Import JSON',
                'buttons.clearList': 'Wyczyść listę',
                'buttons.cancel': 'Anuluj',
                'buttons.saveChanges': 'Zapisz zmiany',
                'buttons.addDeletedEmployee': 'Dodaj usuniętego pracownika',
                'buttons.issueClothing': 'Wydaj odzież',
                'buttons.printCard': 'Drukuj kartę',
                'buttons.addDepartment': 'Dodaj dział',
                'buttons.addPosition': 'Dodaj stanowisko',
                'buttons.addShift': 'Dodaj zmianę',
                'buttons.addCitizenship': 'Dodaj obywatelstwo',
                'buttons.addClothingItem': 'Dodaj element',
                'buttons.permanentlyDelete': 'Usuń trwale',
                
                // Table
                'table.name': 'Nazwisko, Imię',
                'table.position': 'Stanowisko',
                'table.department': 'Dział',
                'table.shift': 'Zmiana',
                'table.rcp': 'RCP',
                'table.citizenship': 'Obywatelstwo',
                'table.locker': 'Szafka',
                'table.hireDate': 'Data przyjęcia',
                'table.deleteDate': 'Data usunięcia',
                'table.actions': 'Akcje',
                'table.editHint': '💡 Wskazówka: Kliknij na dowolną komórkę w tabeli, aby edytować dane bezpośrednio',
                
                // Empty states
                'empty.deletedEmployees': 'Brak usuniętych pracowników',
                
                // Fields
                'fields.nameLabel': 'Nazwisko, Imię',
                'fields.positionLabel': 'Stanowisko',
                'fields.departmentLabel': 'Dział',
                'fields.shiftLabel': 'Zmiana/Kierownik',
                'fields.rcpLabel': 'RCP',
                'fields.citizenshipLabel': 'Obywatelstwo',
                'fields.lockerLabel': 'Szafka',
                'fields.hireDateLabel': 'Data przyjęcia',
                'fields.deleteDateLabel': 'Data usunięcia',
                'fields.employee': 'Pracownik:',
                'fields.notes': 'Uwagi (opcjonalne):',
                'fields.positionPlaceholder': 'Wybierz lub wpisz stanowisko',
                'fields.shiftPlaceholder': 'Wybierz lub wpisz',
                'fields.departmentOther': 'Wpisz nazwę działu',
                'fields.citizenshipOther': 'Wpisz obywatelstwo',
                'fields.notesPlaceholder': 'Dodatkowe informacje...',
                
                // Modals
                'modal.addEmployee': 'Dodaj nowego pracownika',
                'modal.editEmployee': 'Edytuj pracownika',
                'modal.addDeletedEmployee': 'Dodaj usuniętego pracownika',
                'modal.issueClothing': 'Wydaj odzież ochronną',
                
                // Clothing
                'clothing.title': '📦 System wydawania odzieży ochronnej',
                'clothing.description': 'Wybierz pracownika z listy aby wydać lub sprawdzić historię wydanej odzieży',
                'clothing.cardTitle': 'Karta wydania odzieży ochronnej',
                'clothing.lastIssueDate': 'Ostatnio pobrana odzież dnia:',
                'clothing.lastIssue': 'Ostatnie wydanie:',
                'clothing.history': 'Historia wydanej odzieży:',
                'clothing.noHistory': 'Brak historii wydawania',
                'clothing.issueDate': 'Data wydania:',
                'clothing.selectItems': 'Wybierz wydawane elementy:',
                'clothing.issueDateLabel': 'Data wydania:',
                'clothing.issuedItems': 'Wydane elementy:',
                'clothing.notes': 'Uwagi:',
                'clothing.deleteEntry': 'Usuń wpis',
                
                // Training
                'training.title': '🎓 Odzież na szkolenie',
                'training.description': 'Wybierz pracownika z listy, aby zobaczyć przypisaną odzież na szkolenie dla jego stanowiska',
                'training.cardTitle': 'Karta odzieży na szkolenie',
                'training.issuedClothing': 'Wydana odzież',
                'training.noClothingAssigned': 'Brak przypisanej odzieży na szkolenie dla tego stanowiska.',
                'training.goToSettings': 'Przejdź do ustawień, aby przypisać odzież.',
                
                // Settings
                'settings.title': '⚙️ Zarządzanie listami systemowymi',
                'settings.description': 'Tutaj możesz dodawać, edytować i usuwać elementy list używanych w systemie',
                'settings.departments': '📁 Działy',
                'settings.positions': '👷 Stanowiska',
                'settings.shifts': '👥 Zmiany/Kierownicy',
                'settings.citizenships': '🌍 Obywatelstwa',
                'settings.clothingItems': '👔 Elementy odzieży ochronnej',
                'settings.trainingClothesMapping': '🎓 Przypisanie odzieży na szkolenie do stanowisk',
                'settings.newDepartment': 'Nazwa nowego działu...',
                'settings.newPosition': 'Nazwa nowego stanowiska...',
                'settings.newShift': 'Nazwa zmiany lub kierownika...',
                'settings.newCitizenship': 'Nazwa obywatelstwa...',
                'settings.newClothingItem': 'Nazwa elementu odzieży...',
                'settings.addClothingToPosition': '+ Dodaj odzież',
                'settings.noClothingAssigned': 'Brak przypisanej odzieży',
                'settings.clothingItemName': 'Nazwa elementu odzieży...',
                
                // Select
                'select.employee': 'Wybierz pracownika...',
                'select.choose': 'Wybierz...',
                'select.other': 'Inne...',
                
                // Signature
                'signature.employee': 'Podpis pracownika:',
                'signature.issuer': 'Podpis wydającego:',
                
                // Drop zone
                'dropzone.title': 'Przeciągnij plik Excel tutaj',
                'dropzone.formats': 'Obsługiwane formaty .xlsx i .xls',
                
                // Misc
                'misc.dataSaved': 'Dane zapisane',
                'misc.offline': 'Brak połączenia z internetem - pracujesz offline',
                'misc.swipeHint': 'Przesuń w lewo lub prawo aby zmienić zakładkę',
                'misc.clickToRefresh': 'Kliknij aby odświeżyć',
                
                // Toasts
                'toast.welcome': 'Witaj',
                'toast.loggingIn': 'Logowanie...',
                'toast.loginError': 'Błąd logowania:',
                'toast.registrationError': 'Błąd rejestracji:',
                'toast.googleLoginError': 'Błąd logowania przez Google:',
                'toast.accountCreated': 'Konto utworzone pomyślnie!',
                'toast.employeeAdded': 'Pracownik dodany pomyślnie!',
                'toast.employeeUpdated': 'Dane pracownika zaktualizowane!',
                'toast.employeeDeleted': 'Pracownik przeniesiony do usuniętych',
                'toast.employeeRestored': 'Pracownik przywrócony!',
                'toast.employeePermanentlyDeleted': 'Pracownik usunięty trwale!',
                'toast.dataUpdated': 'Dane zaktualizowane',
                'toast.exported': 'Plik został pobrany!',
                'toast.imported': 'Dane zostały zaimportowane pomyślnie!',
                'toast.selectEmployee': 'Najpierw wybierz pracownika!',
                'toast.clothingIssued': 'Odzież wydana pomyślnie!',
                'toast.entryDeleted': 'Wpis usunięty',
                'toast.added': 'Dodano',
                'toast.updated': 'Zaktualizowano',
                'toast.deleted': 'Usunięto',
                'toast.enterValue': 'Wprowadź wartość!',
                'toast.dataSynced': 'Dane zsynchronizowane',
                'toast.syncError': 'Błąd synchronizacji:',
                'toast.refreshing': 'Odświeżanie danych...',
                'toast.dataRefreshed': 'Dane odświeżone pomyślnie!',
                'toast.refreshError': 'Błąd odświeżania:',
                'toast.loadingFile': 'Wczytywanie pliku Excel...',
                'toast.emptyFile': 'Plik Excel jest pusty lub nieprawidłowy',
                'toast.importError': 'Błąd podczas importu pliku Excel:',
                'toast.fileReadError': 'Błąd odczytu pliku',
                'toast.wrongFormat': 'Przeciągnij plik Excel (.xlsx lub .xls)',
                'toast.noValidData': 'Nie znaleziono prawidłowych danych do importu. Sprawdź format pliku.',
                'toast.foundEmployees': 'Znaleziono {count} pracowników',
                'toast.confirmReplace': 'Znaleziono {count} pracowników. Czy chcesz:\n\n1. Dodać do istniejących (OK)\n2. Zastąpić wszystkich (Anuluj i importuj ponownie po wyczyszczeniu)',
                'toast.importedCount': 'Zaimportowano {count} pracowników!',
                'toast.listEmpty': 'Lista pracowników jest już pusta',
                'toast.confirmDeleteAll': 'Czy na pewno chcesz usunąć WSZYSTKICH {count} pracowników?\n\nTa operacja:\n- Przeniesie wszystkich pracowników do listy usuniętych\n- Wyczyści historię wydawania odzieży\n- Zachowa ustawienia systemu\n\nCzy kontynuować?',
                'toast.finalWarning': 'To ostatnie ostrzeżenie! Czy NA PEWNO chcesz usunąć wszystkich pracowników?',
                'toast.allDeleted': 'Wszyscy pracownicy zostali przeniesieni do usuniętych',
                'toast.loginRequired': 'Musisz być zalogowany',
                'toast.selectAtLeastOne': 'Wybierz przynajmniej jeden element odzieży!',
                'toast.confirmDeleteEntry': 'Czy na pewno chcesz usunąć ten wpis?',
                'toast.confirmDelete': 'Czy na pewno chcesz usunąć tego pracownika?',
                'toast.confirmDeletePermanently': 'Czy na pewno chcesz TRWALE usunąć tego pracownika? Ta operacja nie może być cofnięta!',
                'toast.confirmLogout': 'Czy na pewno chcesz się wylogować?',
                'toast.confirmReplaceData': 'Czy na pewno chcesz zastąpić wszystkie dane? Ta operacja nie może być cofnięta!',
                'toast.enterEmail': 'Podaj email:',
                'toast.enterPassword': 'Podaj hasło (minimum 6 znaków):',
                'toast.departmentDetails': 'Dział: {department}',
                'toast.confirmDeleteItem': 'Czy na pewno chcesz usunąć ten element?',
                'toast.confirmRemoveClothing': 'Czy na pewno chcesz usunąć ten element odzieży?',
                'toast.addedToPosition': 'Dodano odzież do stanowiska',
                'toast.removedFromPosition': 'Usunięto odzież ze stanowiska',
                'toast.errorNoField': 'Błąd: nie znaleziono pola wprowadzania',
            },
            ua: {
                // Login
                'login.title': 'Система HR - Синхронізація в реальному часі',
                'login.email': 'Email',
                'login.password': 'Пароль',
                'login.signIn': 'Увійти',
                'login.googleSignIn': 'Увійти через Google',
                'login.register': 'Зареєструватися',
                'login.feature1': '✨ Синхронізація в реальному часі',
                'login.feature2': '📱 Працює на всіх пристроях',
                'login.feature3': '🔒 Безпечне зберігання даних',
                
                // Navigation
                'nav.activeEmployees': 'Активні працівники',
                'nav.deletedEmployees': 'Видалені працівники',
                'nav.clothingIssue': 'Видача одягу',
                'nav.trainingClothes': 'Одяг на навчання',
                'nav.settings': 'Налаштування',
                'nav.logout': 'Вийти',
                
                // Stats
                'stats.totalEmployees': 'Всього працівників',
                'stats.departments': 'Відділів',
                'stats.nationalities': 'Національностей',
                'stats.filteredEmployees': 'Працівників після фільтрування',
                
                // Info
                'info.uploadExcel': '💡 Натисніть кнопку "Завантажити Excel" вище, щоб імпортувати дані з файлу',
                'info.supportedColumns': 'Підтримувані колонки: Прізвище,Ім\'я | Посада | Відділ | Зміна | RCP | Громадянство | Шафка | Дата прийняття',
                
                // Sync
                'sync.title': '🚀 Синхронізація в реальному часі!',
                'sync.auto': '✅ Автоматична синхронізація',
                'sync.autoDesc': 'Всі зміни негайно синхронізуються між пристроями',
                'sync.multi': '📱 Мульти-пристрій',
                'sync.multiDesc': 'Працюйте на комп\'ютері, планшеті та телефоні одночасно',
                'sync.security': '🔒 Безпека',
                'sync.securityDesc': 'Дані безпечно зберігаються в хмарі Firebase',
                'sync.offline': '⚡ Робота офлайн',
                'sync.offlineDesc': 'Додаток працює без інтернету - дані синхронізуються після підключення',
                'sync.collaboration': '👥 Співпраця',
                'sync.collaborationDesc': 'Увійдіть з одним обліковим записом на різних пристроях',
                'sync.firebaseRules': '🔐 Важливо! Встановіть правила безпеки в Firebase Console:',
                'sync.changeRules': 'Змінити на:',
                'sync.howItWorks': 'Як це працює:',
                'sync.step1': '1. Внесіть зміни на будь-якому пристрої',
                'sync.step2': '2. Дані автоматично з\'являться на інших пристроях',
                'sync.step3': '3. Статус синхронізації видно в правому верхньому куті (натисніть для оновлення)',
                'sync.step4': '4. Немає потреби в ручному збереженні!',
                
                // Departments
                'departments.statsTitle': '📊 Статистика за відділами',
                'departments.distribution': 'Розподіл працівників за відділами',
                'departments.employeeCount': 'Кількість працівників:',
                'departments.positions': 'посад',
                
                // Filters
                'filters.byDepartment': 'Фільтрувати за відділом:',
                'filters.allDepartments': 'Всі відділи',
                'filters.byPosition': 'Фільтрувати за посадою:',
                'filters.allPositions': 'Всі посади',
                'filters.byShift': 'Фільтрувати за зміною:',
                'filters.allShifts': 'Всі зміни',
                
                // Sort
                'sort.byHireDate': 'Сортувати за датою прийняття:',
                'sort.byDeleteDate': 'Сортувати за датою видалення:',
                'sort.newest': 'Найновіші',
                'sort.oldest': 'Найстаріші',
                
                // Search
                'search.employees': 'Шукати працівників...',
                
                // Buttons
                'buttons.addEmployee': 'Додати працівника',
                'buttons.loadExcel': 'Завантажити Excel',
                'buttons.exportExcel': 'Експорт Excel',
                'buttons.backupJSON': 'Резервне копіювання JSON',
                'buttons.sampleExcel': 'Приклад Excel',
                'buttons.importJSON': 'Імпорт JSON',
                'buttons.clearList': 'Очистити список',
                'buttons.cancel': 'Скасувати',
                'buttons.saveChanges': 'Зберегти зміни',
                'buttons.addDeletedEmployee': 'Додати видаленого працівника',
                'buttons.issueClothing': 'Видати одяг',
                'buttons.printCard': 'Друкувати картку',
                'buttons.addDepartment': 'Додати відділ',
                'buttons.addPosition': 'Додати посаду',
                'buttons.addShift': 'Додати зміну',
                'buttons.addCitizenship': 'Додати громадянство',
                'buttons.addClothingItem': 'Додати елемент',
                'buttons.permanentlyDelete': 'Видалити назавжди',
                
                // Table
                'table.name': 'Прізвище, Ім\'я',
                'table.position': 'Посада',
                'table.department': 'Відділ',
                'table.shift': 'Зміна',
                'table.rcp': 'RCP',
                'table.citizenship': 'Громадянство',
                'table.locker': 'Шафка',
                'table.hireDate': 'Дата прийняття',
                'table.deleteDate': 'Дата видалення',
                'table.actions': 'Дії',
                'table.editHint': '💡 Підказка: Клацніть на будь-яку комірку в таблиці, щоб редагувати дані безпосередньо',
                
                // Empty states
                'empty.deletedEmployees': 'Немає видалених працівників',
                
                // Fields
                'fields.nameLabel': 'Прізвище, Ім\'я',
                'fields.positionLabel': 'Посада',
                'fields.departmentLabel': 'Відділ',
                'fields.shiftLabel': 'Зміна/Керівник',
                'fields.rcpLabel': 'RCP',
                'fields.citizenshipLabel': 'Громадянство',
                'fields.lockerLabel': 'Шафка',
                'fields.hireDateLabel': 'Дата прийняття',
                'fields.deleteDateLabel': 'Дата видалення',
                'fields.employee': 'Працівник:',
                'fields.notes': 'Примітки (необов\'язково):',
                'fields.positionPlaceholder': 'Виберіть або введіть посаду',
                'fields.shiftPlaceholder': 'Виберіть або введіть',
                'fields.departmentOther': 'Введіть назву відділу',
                'fields.citizenshipOther': 'Введіть громадянство',
                'fields.notesPlaceholder': 'Додаткова інформація...',
                
                // Select
                'select.employee': 'Виберіть працівника...',
                'select.choose': 'Виберіть...',
                'select.other': 'Інше...',
                
                // Toasts
                'toast.welcome': 'Ласкаво просимо',
                'toast.employeeAdded': 'Працівника додано успішно!',
                'toast.employeeUpdated': 'Дані працівника оновлено!',
                'toast.employeeDeleted': 'Працівника переміщено до видалених',
                'toast.employeeRestored': 'Працівника відновлено!',
                'toast.employeePermanentlyDeleted': 'Працівника видалено назавжди!',
                'toast.selectEmployee': 'Спочатку виберіть працівника!',
                'toast.clothingIssued': 'Одяг видано успішно!',
                'toast.confirmDeletePermanently': 'Ви впевнені, що хочете НАЗАВЖДИ видалити цього працівника? Цю дію не можна скасувати!',
                'toast.allDeleted': 'Усіх працівників переміщено до видалених',
            },
            en: {
                // Login
                'login.title': 'HR System - Real-time Synchronization',
                'login.email': 'Email',
                'login.password': 'Password',
                'login.signIn': 'Sign In',
                'login.googleSignIn': 'Sign in with Google',
                'login.register': 'Register',
                'login.feature1': '✨ Real-time synchronization',
                'login.feature2': '📱 Works on all devices',
                'login.feature3': '🔒 Secure data storage',
                
                // Navigation
                'nav.activeEmployees': 'Active Employees',
                'nav.deletedEmployees': 'Deleted Employees',
                'nav.clothingIssue': 'Clothing Issue',
                'nav.trainingClothes': 'Training Clothes',
                'nav.settings': 'Settings',
                'nav.logout': 'Logout',
                
                // Stats
                'stats.totalEmployees': 'Total Employees',
                'stats.departments': 'Departments',
                'stats.nationalities': 'Nationalities',
                'stats.filteredEmployees': 'Filtered Employees',
                
                // Info
                'info.uploadExcel': '💡 Click the "Load Excel" button above to import data from a file',
                'info.supportedColumns': 'Supported columns: Last Name,First Name | Position | Department | Shift | RCP | Citizenship | Locker | Hire Date',
                
                // Sync
                'sync.title': '🚀 Real-time synchronization!',
                'sync.auto': '✅ Automatic synchronization',
                'sync.autoDesc': 'All changes are immediately synchronized between devices',
                'sync.multi': '📱 Multi-device',
                'sync.multiDesc': 'Work on computer, tablet and phone simultaneously',
                'sync.security': '🔒 Security',
                'sync.securityDesc': 'Data is securely stored in Firebase cloud',
                'sync.offline': '⚡ Offline work',
                'sync.offlineDesc': 'App works without internet - data will sync when connected',
                'sync.collaboration': '👥 Collaboration',
                'sync.collaborationDesc': 'Log in with the same account on different devices',
                'sync.firebaseRules': '🔐 Important! Set security rules in Firebase Console:',
                'sync.changeRules': 'Change to:',
                'sync.howItWorks': 'How it works:',
                'sync.step1': '1. Make changes on any device',
                'sync.step2': '2. Data will automatically appear on other devices',
                'sync.step3': '3. Sync status visible in top right corner (click to refresh)',
                'sync.step4': '4. No need for manual saving!',
                
                // Departments
                'departments.statsTitle': '📊 Statistics by departments',
                'departments.distribution': 'Employee distribution by departments',
                'departments.employeeCount': 'Employee count:',
                'departments.positions': 'positions',
                
                // Filters
                'filters.byDepartment': 'Filter by department:',
                'filters.allDepartments': 'All departments',
                'filters.byPosition': 'Filter by position:',
                'filters.allPositions': 'All positions',
                'filters.byShift': 'Filter by shift:',
                'filters.allShifts': 'All shifts',
                
                // Sort
                'sort.byHireDate': 'Sort by hire date:',
                'sort.byDeleteDate': 'Sort by delete date:',
                'sort.newest': 'Newest',
                'sort.oldest': 'Oldest',
                
                // Search
                'search.employees': 'Search employees...',
                
                // Buttons
                'buttons.addEmployee': 'Add Employee',
                'buttons.loadExcel': 'Load Excel',
                'buttons.exportExcel': 'Export Excel',
                'buttons.backupJSON': 'Backup JSON',
                'buttons.sampleExcel': 'Sample Excel',
                'buttons.importJSON': 'Import JSON',
                'buttons.clearList': 'Clear List',
                'buttons.cancel': 'Cancel',
                'buttons.saveChanges': 'Save Changes',
                'buttons.addDeletedEmployee': 'Add Deleted Employee',
                'buttons.issueClothing': 'Issue Clothing',
                'buttons.printCard': 'Print Card',
                'buttons.addDepartment': 'Add Department',
                'buttons.addPosition': 'Add Position',
                'buttons.addShift': 'Add Shift',
                'buttons.addCitizenship': 'Add Citizenship',
                'buttons.addClothingItem': 'Add Item',
                'buttons.permanentlyDelete': 'Delete Permanently',
                
                // Table
                'table.name': 'Last Name, First Name',
                'table.position': 'Position',
                'table.department': 'Department',
                'table.shift': 'Shift',
                'table.rcp': 'RCP',
                'table.citizenship': 'Citizenship',
                'table.locker': 'Locker',
                'table.hireDate': 'Hire Date',
                'table.deleteDate': 'Delete Date',
                'table.actions': 'Actions',
                'table.editHint': '💡 Tip: Click on any cell in the table to edit data directly',
                
                // Empty states
                'empty.deletedEmployees': 'No deleted employees',
                
                // Select
                'select.employee': 'Select employee...',
                'select.choose': 'Choose...',
                'select.other': 'Other...',
                
                // Toasts
                'toast.welcome': 'Welcome',
                'toast.employeeAdded': 'Employee added successfully!',
                'toast.employeeUpdated': 'Employee data updated!',
                'toast.employeeDeleted': 'Employee moved to deleted',
                'toast.employeeRestored': 'Employee restored!',
                'toast.employeePermanentlyDeleted': 'Employee permanently deleted!',
                'toast.selectEmployee': 'Please select an employee first!',
                'toast.clothingIssued': 'Clothing issued successfully!',
                'toast.confirmDeletePermanently': 'Are you sure you want to PERMANENTLY delete this employee? This action cannot be undone!',
                'toast.allDeleted': 'All employees have been moved to deleted',
            },
            es: {
                // Login
                'login.title': 'Sistema HR - Sincronización en tiempo real',
                'login.email': 'Correo electrónico',
                'login.password': 'Contraseña',
                'login.signIn': 'Iniciar sesión',
                'login.googleSignIn': 'Iniciar sesión con Google',
                'login.register': 'Registrarse',
                'login.feature1': '✨ Sincronización en tiempo real',
                'login.feature2': '📱 Funciona en todos los dispositivos',
                'login.feature3': '🔒 Almacenamiento seguro de datos',
                
                // Navigation
                'nav.activeEmployees': 'Empleados Activos',
                'nav.deletedEmployees': 'Empleados Eliminados',
                'nav.clothingIssue': 'Entrega de Ropa',
                'nav.trainingClothes': 'Ropa de Entrenamiento',
                'nav.settings': 'Configuración',
                'nav.logout': 'Cerrar sesión',
                
                // Stats
                'stats.totalEmployees': 'Total de Empleados',
                'stats.departments': 'Departamentos',
                'stats.nationalities': 'Nacionalidades',
                'stats.filteredEmployees': 'Empleados Filtrados',
                
                // Buttons
                'buttons.addEmployee': 'Agregar Empleado',
                'buttons.loadExcel': 'Cargar Excel',
                'buttons.exportExcel': 'Exportar Excel',
                'buttons.backupJSON': 'Copia de seguridad JSON',
                'buttons.sampleExcel': 'Excel de muestra',
                'buttons.importJSON': 'Importar JSON',
                'buttons.clearList': 'Limpiar Lista',
                'buttons.cancel': 'Cancelar',
                'buttons.saveChanges': 'Guardar Cambios',
                'buttons.addDeletedEmployee': 'Agregar Empleado Eliminado',
                'buttons.issueClothing': 'Entregar Ropa',
                'buttons.printCard': 'Imprimir Tarjeta',
                'buttons.addDepartment': 'Agregar Departamento',
                'buttons.addPosition': 'Agregar Posición',
                'buttons.addShift': 'Agregar Turno',
                'buttons.addCitizenship': 'Agregar Ciudadanía',
                'buttons.addClothingItem': 'Agregar Elemento',
                'buttons.permanentlyDelete': 'Eliminar Permanentemente',
                
                // Table
                'table.name': 'Apellido, Nombre',
                'table.position': 'Posición',
                'table.department': 'Departamento',
                'table.shift': 'Turno',
                'table.rcp': 'RCP',
                'table.citizenship': 'Ciudadanía',
                'table.locker': 'Casillero',
                'table.hireDate': 'Fecha de Contratación',
                'table.deleteDate': 'Fecha de Eliminación',
                'table.actions': 'Acciones',
                
                // Select
                'select.employee': 'Seleccionar empleado...',
                'select.choose': 'Elegir...',
                'select.other': 'Otro...',
                
                // Toasts
                'toast.welcome': 'Bienvenido',
                'toast.employeeAdded': '¡Empleado agregado con éxito!',
                'toast.employeeUpdated': '¡Datos del empleado actualizados!',
                'toast.employeeDeleted': 'Empleado movido a eliminados',
                'toast.employeeRestored': '¡Empleado restaurado!',
                'toast.employeePermanentlyDeleted': '¡Empleado eliminado permanentemente!',
                'toast.selectEmployee': '¡Primero seleccione un empleado!',
                'toast.clothingIssued': '¡Ropa entregada con éxito!',
                'toast.confirmDeletePermanently': '¿Está seguro de que desea eliminar PERMANENTEMENTE este empleado? ¡Esta acción no se puede deshacer!',
                'toast.allDeleted': 'Todos los empleados han sido movidos a eliminados',
            }
        };
        
        let currentLanguage = localStorage.getItem('appLanguage') || 'pl';
        
        // Function to change language
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
            
            // Update all translations
            updateTranslations();
            
            // Update dynamic content
            renderEmployees();
            renderDeletedEmployees();
            updateDropdowns();
            updateStats();
            renderSettingsLists();
            
            // Update sync status tooltip
            const syncStatus = document.getElementById('sync-status');
            if (syncStatus) {
                syncStatus.setAttribute('data-tooltip', i18n('misc.clickToRefresh'));
            }
        }
        
        // Function to get translation
        function i18n(key) {
            return translations[currentLanguage][key] || translations['pl'][key] || key;
        }
        
        // Function to update all translations in DOM
        function updateTranslations() {
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = i18n(key);
            });
            
            // Update all placeholders with data-i18n-placeholder attribute
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = i18n(key);
            });
        }

        // ==============================================
        // FIREBASE CONFIGURATION
        // ==============================================
        const firebaseConfig = {
            apiKey: "AIzaSyANGkq3nCLllDjYbIGsZW4N9BOtBDCJNbo",
            authDomain: "hr-system-sync-f4517.firebaseapp.com",
            databaseURL: "https://hr-system-sync-f4517-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "hr-system-sync-f4517",
            storageBucket: "hr-system-sync-f4517.firebasestorage.app",
            messagingSenderId: "396906615629",
            appId: "1:396906615629:web:90d1c6a1ed3971d58d5d04",
            measurementId: "G-DYHL19MCL9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Get references to services
        const auth = firebase.auth();
        const database = firebase.database();

        // ==============================================
        // ZMIENNE GLOBALNE
        // ==============================================
        let currentUser = null;
        let employees = [];
        let deletedEmployees = [];
        let clothingRecords = {};
        let positionClothesMapping = {};
        let sortColumn = null;
        let sortDirection = 'asc';
        let nextEmployeeId = 1;
        let dbRef = null; // Reference do bazy danych użytkownika
        let isFirstLoad = true;
        let syncInProgress = false;

        // Zmienne dla filtrów
        let activeFilters = {
            department: '',
            position: '',
            shift: ''
        };

        // Listy konfiguracyjne
        let systemLists = {
            departments: ['DZIAŁ_SPAWALNIA_UA', 'DZIAŁ_SPAWALNIA_UA_ROBOT', 'DZIAŁ_SPAWALNIA_PL', 'DZIAŁ_MONTAŻ', 'DZIAŁ_KONTROLA_JAKOŚCI'],
            positions: ['Spawacz MIG/MAG', 'Spawacz TIG', 'Operator robota', 'Szlifierz', 'Monter', 'Kontroler jakości'],
            shifts: ['HRABKO VIACHESLAV', 'Katarzyna Krzyżanek', 'Gracjan Łomozik', 'Adam Nowak', 'Jan Kowalski'],
            citizenships: ['ukraińskie', 'polskie', 'indyjskie', 'kolumbijskie', 'hiszpańskie', 'meksykańskie', 'amerykańskie', 'chińskie'],
            clothingItems: ['Kask', 'Okulary', 'Rękawice', 'Kurtka', 'Spodnie', 'Buty', 'Kamizelka', 'Stopery']
        };

        // Domyślne mapowanie stanowisk do odzieży na szkolenie
        const defaultPositionClothesMapping = {
            'Spawacz MIG_MAG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
            'Spawacz TIG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
            'Operator robota': ['buty', 'spodnie', 'bluza', 'okulary ochronne'],
            'Szlifierz': ['buty', 'spodnie', 'bluza', 'okulary ochronne', 'maska przeciwpyłowa'],
            'Monter': ['buty', 'spodnie', 'bluza', 'rękawice montażowe'],
            'Kontroler jakości': ['buty', 'spodnie', 'bluza']
        };
        
        // Funkcja do sanityzacji kluczy dla Firebase
        function sanitizeFirebaseKey(key) {
            if (!key) return '';
            // Zamień niedozwolone znaki na podkreślenia
            return key.toString()
                .replace(/\//g, '_')
                .replace(/\./g, '_')
                .replace(/#/g, '_')
                .replace(/\$/g, '_')
                .replace(/\[/g, '_')
                .replace(/\]/g, '_');
        }
        
        // Funkcja do desanityzacji kluczy z Firebase
        function desanitizeFirebaseKey(key) {
            // Dla teraz zwracamy klucz bez zmian
            // W przyszłości można dodać mapowanie jeśli potrzebne
            return key;
        }

        // ==============================================
        // AUTHENTICATION
        // ==============================================
        function loginWithEmail(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            showToast(i18n('toast.loggingIn'), 'info');
            
            auth.signInWithEmailAndPassword(email, password)
                .catch((error) => {
                    console.error('Login error:', error);
                    showToast(i18n('toast.loginError') + ' ' + error.message, 'error');
                });
        }

        function registerWithEmail() {
            const email = prompt(i18n('toast.enterEmail'));
            const password = prompt(i18n('toast.enterPassword'));
            
            if (email && password) {
                auth.createUserWithEmailAndPassword(email, password)
                    .then(() => {
                        showToast(i18n('toast.accountCreated'));
                    })
                    .catch((error) => {
                        console.error('Registration error:', error);
                        showToast(i18n('toast.registrationError') + ' ' + error.message, 'error');
                    });
            }
        }

        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .catch((error) => {
                    console.error('Google login error:', error);
                    showToast(i18n('toast.googleLoginError') + ' ' + error.message, 'error');
                });
        }

        function logout() {
            if (confirm(i18n('toast.confirmLogout'))) {
                auth.signOut();
            }
        }

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            console.log('Auth state changed:', user ? user.email : 'not logged in');
            currentUser = user;
            
            if (user) {
                // User is signed in
                document.getElementById('login-panel').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                // Set up database reference for this user
                const userId = user.uid;
                console.log('User ID:', userId);
                
                // Clean up old reference
                if (dbRef) {
                    dbRef.off();
                }
                
                dbRef = database.ref('users/' + userId);
                console.log('Database reference created');
                
                // Initialize real-time sync
                initializeRealtimeSync();
                
                // Set up event listeners after login
                setupEventListeners();
                
                // Update translations
                updateTranslations();
                
                // Force initial data load
                dbRef.once('value').then((snapshot) => {
                    console.log('Initial data load complete');
                    const data = snapshot.val();
                    if (!data || Object.keys(data).length === 0) {
                        console.log('No data found for user, initializing empty state');
                        saveToFirebase(); // Initialize empty data structure
                    }
                }).catch((error) => {
                    console.error('Initial data load error:', error);
                });
                
                showToast(`${i18n('toast.welcome')} ${user.email}!`);
            } else {
                // User is signed out
                document.getElementById('login-panel').style.display = 'block';
                document.getElementById('main-app').style.display = 'none';
                
                // Clean up listeners
                if (dbRef) {
                    dbRef.off();
                    dbRef = null;
                }
            }
        });

        // ==============================================
        // REAL-TIME SYNC
        // ==============================================
        function initializeRealtimeSync() {
            updateSyncStatus('syncing');
            
            // Enable offline persistence
            database.goOffline();
            database.goOnline();
            
            // Force reconnection on mobile devices
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                console.log('Mobile device detected - forcing reconnection');
                // Force a fresh connection
                database.ref('.info/connected').once('value', (snapshot) => {
                    if (!snapshot.val()) {
                        database.goOffline();
                        setTimeout(() => {
                            database.goOnline();
                        }, 1000);
                    }
                });
            }
            
            // Listen for connection state
            database.ref('.info/connected').on('value', (snapshot) => {
                const connected = snapshot.val();
                console.log('Connection state:', connected);
                if (connected) {
                    updateSyncStatus('synced');
                    document.getElementById('offline-indicator').classList.remove('show');
                    // Force data reload on reconnection
                    if (dbRef) {
                        dbRef.once('value').then((dataSnapshot) => {
                            console.log('Data reloaded after reconnection');
                        });
                    }
                } else {
                    updateSyncStatus('offline');
                    document.getElementById('offline-indicator').classList.add('show');
                }
            });
            
            // Listen for data changes with error handling
            if (dbRef) {
                dbRef.off(); // Remove existing listeners
                
                dbRef.on('value', (snapshot) => {
                    if (syncInProgress) return;
                    
                    console.log('Data received from Firebase');
                    const data = snapshot.val() || {};
                    console.log('Data structure:', Object.keys(data));
                    
                    // Update local data from Firebase
                    employees = data.employees || [];
                    deletedEmployees = data.deletedEmployees || [];
                    clothingRecords = data.clothingRecords || {};
                    
                    // Desanityzacja kluczy w positionClothesMapping
                    const loadedMapping = data.positionClothesMapping || {};
                    positionClothesMapping = {};
                    Object.keys(loadedMapping).forEach(sanitizedKey => {
                        let originalKey = sanitizedKey;
                        if (sanitizedKey === 'Spawacz MIG_MAG') {
                            originalKey = 'Spawacz MIG/MAG';
                        }
                        positionClothesMapping[originalKey] = loadedMapping[sanitizedKey];
                    });
                    
                    // Jeśli brak mapowania, użyj domyślnego
                    if (Object.keys(positionClothesMapping).length === 0) {
                        positionClothesMapping = {
                            'Spawacz MIG/MAG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
                            'Spawacz TIG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
                            'Operator robota': ['buty', 'spodnie', 'bluza', 'okulary ochronne'],
                            'Szlifierz': ['buty', 'spodnie', 'bluza', 'okulary ochronne', 'maska przeciwpyłowa'],
                            'Monter': ['buty', 'spodnie', 'bluza', 'rękawice montażowe'],
                            'Kontroler jakości': ['buty', 'spodnie', 'bluza']
                        };
                    }
                    
                    systemLists = data.systemLists || systemLists;
                    nextEmployeeId = data.nextEmployeeId || 1;
                    
                    // Update UI - zawsze odśwież interfejs
                    renderEmployees();
                    updateStats();
                    renderDeletedEmployees();
                    updateClothingEmployeesList();
                    updateTrainingEmployeesList();
                    renderSettingsLists();
                    renderPositionClothesMapping();
                    updateDropdowns();
                    
                    if (!isFirstLoad) {
                        showToast(i18n('toast.dataSynced'), 'success');
                    }
                    
                    isFirstLoad = false;
                    updateSyncStatus('synced');
                    
                    // Hide info card if there are employees
                    const infoCard = document.getElementById('info-card');
                    if (infoCard) {
                        infoCard.style.display = employees.length > 0 ? 'none' : 'block';
                    }
                }, (error) => {
                    console.error('Firebase sync error:', error);
                    updateSyncStatus('error');
                    showToast(i18n('toast.syncError') + ' ' + error.message, 'error');
                    
                    // Retry connection
                    setTimeout(() => {
                        console.log('Retrying connection...');
                        database.goOffline();
                        database.goOnline();
                    }, 5000);
                });
            }
        }

        function saveToFirebase() {
            if (!dbRef || syncInProgress) return;
            
            syncInProgress = true;
            updateSyncStatus('syncing');
            
            // Sanityzacja kluczy w positionClothesMapping
            const sanitizedPositionClothesMapping = {};
            Object.keys(positionClothesMapping).forEach(position => {
                const sanitizedKey = sanitizeFirebaseKey(position);
                sanitizedPositionClothesMapping[sanitizedKey] = positionClothesMapping[position];
            });
            
            const data = {
                employees: employees,
                deletedEmployees: deletedEmployees,
                clothingRecords: clothingRecords,
                positionClothesMapping: sanitizedPositionClothesMapping,
                nextEmployeeId: nextEmployeeId,
                systemLists: systemLists,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            };
            
            dbRef.set(data)
                .then(() => {
                    updateSyncStatus('synced');
                    showAutoSaveIndicator();
                })
                .catch((error) => {
                    console.error('Save error:', error);
                    updateSyncStatus('error');
                    showToast(i18n('toast.syncError') + ' ' + error.message, 'error');
                })
                .finally(() => {
                    syncInProgress = false;
                });
        }

        function updateSyncStatus(status) {
            const syncStatus = document.getElementById('sync-status');
            const syncIcon = document.getElementById('sync-icon');
            const syncText = document.getElementById('sync-text');
            
            // Remove all status classes
            syncStatus.classList.remove('syncing', 'synced', 'error', 'offline');
            syncIcon.classList.remove('rotating');
            
            const statusTexts = {
                syncing: { pl: 'Synchronizacja...', ua: 'Синхронізація...', en: 'Synchronizing...', es: 'Sincronizando...' },
                synced: { pl: 'Zsynchronizowano', ua: 'Синхронізовано', en: 'Synchronized', es: 'Sincronizado' },
                error: { pl: 'Błąd synchronizacji', ua: 'Помилка синхронізації', en: 'Sync error', es: 'Error de sincronización' },
                offline: { pl: 'Tryb offline', ua: 'Офлайн режим', en: 'Offline mode', es: 'Modo sin conexión' }
            };
            
            switch(status) {
                case 'syncing':
                    syncStatus.classList.add('syncing');
                    syncIcon.classList.add('rotating');
                    syncText.textContent = statusTexts.syncing[currentLanguage] || statusTexts.syncing.pl;
                    break;
                case 'synced':
                    syncStatus.classList.add('synced');
                    syncText.textContent = statusTexts.synced[currentLanguage] || statusTexts.synced.pl;
                    break;
                case 'error':
                    syncStatus.classList.add('error');
                    syncText.textContent = statusTexts.error[currentLanguage] || statusTexts.error.pl;
                    break;
                case 'offline':
                    syncStatus.classList.add('offline');
                    syncText.textContent = statusTexts.offline[currentLanguage] || statusTexts.offline.pl;
                    break;
            }
        }

        // ==============================================
        // CORE FUNCTIONS (updated for Firebase)
        // ==============================================
        
        // Pokazanie wskaźnika auto-zapisu
        function showAutoSaveIndicator() {
            const indicator = document.getElementById('auto-save-indicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Generowanie unikalnego ID
        function generateUniqueId() {
            return nextEmployeeId++;
        }

        // Aktualizacja listy pracowników dla odzieży na szkolenie
        function updateTrainingEmployeesList() {
            const select = document.getElementById('training-employee-select');
            if (!select) return;
            
            select.innerHTML = `<option value="">${i18n('select.employee')}</option>`;
            
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.name} - ${emp.department} - ${emp.position}`;
                select.appendChild(option);
            });
        }

        // Ładowanie odzieży na szkolenie dla wybranego pracownika
        function loadTrainingClothes() {
            const employeeId = document.getElementById('training-employee-select').value;
            
            if (!employeeId) {
                document.getElementById('training-clothes-display').style.display = 'none';
                return;
            }
            
            const employee = employees.find(emp => emp.id == employeeId);
            if (!employee) return;
            
            // Pokaż sekcję
            document.getElementById('training-clothes-display').style.display = 'block';
            
            // Wypełnij dane pracownika
            document.getElementById('training-employee-name').textContent = employee.name;
            document.getElementById('training-employee-rcp').textContent = employee.rcp || '-';
            document.getElementById('training-employee-position').textContent = employee.position || '-';
            document.getElementById('training-employee-department').textContent = employee.department || '-';
            
            // Pobierz listę odzieży dla stanowiska
            const position = employee.position;
            const clothesList = positionClothesMapping[position] || [];
            
            // Wyświetl listę odzieży
            const listContainer = document.getElementById('training-clothes-list');
            if (clothesList.length > 0) {
                listContainer.innerHTML = clothesList.map(item => `
                    <div class="clothes-item">${item}</div>
                `).join('');
            } else {
                listContainer.innerHTML = `
                    <div style="text-align: center; color: rgba(255, 255, 255, 0.5); padding: 2rem;">
                        ${i18n('training.noClothingAssigned')}
                        <br><br>
                        ${i18n('training.goToSettings')}
                    </div>
                `;
            }
            
            // Pokaż sekcję podpisów
            document.querySelector('#training-clothes-display .signature-section').style.display = 'block';
        }

        // Funkcja drukowania karty odzieży na szkolenie - NAPRAWIONA
        function printTrainingClothes() {
            const employeeId = document.getElementById('training-employee-select').value;
            
            if (!employeeId) {
                showToast(i18n('toast.selectEmployee'), 'error');
                return;
            }
            
            // Dodaj klasę do body podczas drukowania
            document.body.classList.add('printing-training');
            
            // Drukuj
            window.print();
            
            // Usuń klasę po drukowaniu
            setTimeout(() => {
                document.body.classList.remove('printing-training');
            }, 100);
        }

        // Renderowanie mapowania stanowisk do odzieży
        function renderPositionClothesMapping() {
            const container = document.getElementById('position-clothes-mapping');
            if (!container) return;
            
            container.innerHTML = systemLists.positions.map(position => {
                const clothes = positionClothesMapping[position] || [];
                const safeId = position.replace(/\s+/g, '-').replace(/\//g, '-').replace(/[^\w-]/g, '');
                return `
                    <div class="mapping-item">
                        <div class="mapping-position">
                            <span>${position}</span>
                            <button class="btn btn-primary btn-sm" onclick="showAddClothesForm('${position.replace(/'/g, "\\'")}')" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">
                                ${i18n('settings.addClothingToPosition')}
                            </button>
                        </div>
                        <div class="clothes-tags">
                            ${clothes.map((item, index) => `
                                <span class="clothes-tag">
                                    ${item}
                                    <span class="remove-tag" onclick="removeClothesFromPosition('${position.replace(/'/g, "\\'")}', ${index})">×</span>
                                </span>
                            `).join('')}
                            ${clothes.length === 0 ? `<span style="color: rgba(255, 255, 255, 0.5); font-size: 0.85rem;">${i18n('settings.noClothingAssigned')}</span>` : ''}
                        </div>
                        <div id="add-clothes-form-${safeId}" style="display: none; margin-top: 0.75rem;">
                            <div class="add-clothes-form">
                                <input type="text" class="form-input" placeholder="${i18n('settings.clothingItemName')}" 
                                       id="new-clothes-${safeId}" 
                                       style="flex: 1;">
                                <button class="btn btn-success" onclick="addClothesToPosition('${position.replace(/'/g, "\\'")}')">
                                    ${i18n('buttons.addClothingItem')}
                                </button>
                                <button class="btn" onclick="hideAddClothesForm('${position.replace(/'/g, "\\'")}')" 
                                        style="background: rgba(255,255,255,0.1); color: white;">
                                    ${i18n('buttons.cancel')}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Pokazanie formularza dodawania odzieży
        function showAddClothesForm(position) {
            const safeId = position.replace(/\s+/g, '-').replace(/\//g, '-').replace(/[^\w-]/g, '');
            const formId = `add-clothes-form-${safeId}`;
            const form = document.getElementById(formId);
            if (form) {
                form.style.display = 'block';
            }
        }

        // Ukrycie formularza dodawania odzieży
        function hideAddClothesForm(position) {
            const safeId = position.replace(/\s+/g, '-').replace(/\//g, '-').replace(/[^\w-]/g, '');
            const formId = `add-clothes-form-${safeId}`;
            const form = document.getElementById(formId);
            if (form) {
                form.style.display = 'none';
            }
            const inputId = `new-clothes-${safeId}`;
            const input = document.getElementById(inputId);
            if (input) {
                input.value = '';
            }
        }

        // Dodanie odzieży do stanowiska
        function addClothesToPosition(position) {
            const safeId = position.replace(/\s+/g, '-').replace(/\//g, '-').replace(/[^\w-]/g, '');
            const inputId = `new-clothes-${safeId}`;
            const input = document.getElementById(inputId);
            if (!input) {
                showToast(i18n('toast.errorNoField'), 'error');
                return;
            }
            
            const clothesName = input.value.trim();
            
            if (!clothesName) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            if (!positionClothesMapping[position]) {
                positionClothesMapping[position] = [];
            }
            
            positionClothesMapping[position].push(clothesName);
            
            hideAddClothesForm(position);
            renderPositionClothesMapping();
            saveToFirebase();
            showToast(i18n('toast.addedToPosition'));
        }

        // Usunięcie odzieży ze stanowiska
        function removeClothesFromPosition(position, index) {
            if (confirm(i18n('toast.confirmRemoveClothing'))) {
                positionClothesMapping[position].splice(index, 1);
                renderPositionClothesMapping();
                saveToFirebase();
                showToast(i18n('toast.removedFromPosition'));
            }
        }

        // ==============================================
        // PODSTAWOWE FUNKCJE APLIKACJI
        // ==============================================

        // Renderowanie pracowników
        function renderEmployees() {
            const tbody = document.getElementById('employees-tbody');
            const mobileCards = document.getElementById('mobile-cards');
            
            let filteredEmployees = applyFiltersToEmployees();
            
            if (sortColumn) {
                filteredEmployees.sort((a, b) => {
                    let aVal = a[sortColumn] || '';
                    let bVal = b[sortColumn] || '';
                    
                    if (sortColumn === 'rcp' || sortColumn === 'locker') {
                        aVal = parseInt(aVal) || 0;
                        bVal = parseInt(bVal) || 0;
                    } else if (sortColumn === 'hireDate') {
                        aVal = new Date(aVal || '1900-01-01');
                        bVal = new Date(bVal || '1900-01-01');
                    } else {
                        aVal = aVal.toString().toLowerCase();
                        bVal = bVal.toString().toLowerCase();
                    }
                    
                    if (sortDirection === 'asc') {
                        return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
                    } else {
                        return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
                    }
                });
            }
            
            // Desktop view
            tbody.innerHTML = filteredEmployees.map(emp => `
                <tr>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'name')">${emp.name}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'position')">${emp.position}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'department')">${emp.department}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'shift')">${emp.shift || ''}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'rcp')">${emp.rcp || ''}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'citizenship')">${emp.citizenship}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'locker')">${emp.locker || ''}</td>
                    <td class="editable" onclick="makeEditable(this, ${emp.id}, 'hireDate')">${formatDate(emp.hireDate)}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-icon edit" onclick="editEmployee(${emp.id})" title="${i18n('buttons.edit')}">✏️</button>
                            <button class="btn-icon delete" onclick="deleteEmployee(${emp.id})" title="${i18n('buttons.delete')}">🗑️</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Mobile view
            mobileCards.innerHTML = filteredEmployees.map(emp => `
                <div class="employee-card">
                    <div class="employee-card-header">
                        <div>
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-position">${emp.position}</div>
                        </div>
                        <div class="card-actions">
                            <button class="btn-icon edit" onclick="editEmployee(${emp.id})">✏️</button>
                            <button class="btn-icon delete" onclick="deleteEmployee(${emp.id})">🗑️</button>
                        </div>
                    </div>
                    <div class="employee-details">
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.department')}:</span>
                            <span>${emp.department}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.shift')}:</span>
                            <span>${emp.shift || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.rcp')}:</span>
                            <span>${emp.rcp || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.citizenship')}:</span>
                            <span>${emp.citizenship}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.locker')}:</span>
                            <span>${emp.locker || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.hireDate')}:</span>
                            <span>${formatDate(emp.hireDate)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            updateHeaders();
            updateStats();
            updateDepartmentStats();
        }

        // Aplikowanie filtrów
        function applyFiltersToEmployees() {
            let filtered = [...employees];
            
            // Filtr po dziale
            if (activeFilters.department) {
                filtered = filtered.filter(emp => emp.department === activeFilters.department);
            }
            
            // Filtr po stanowisku
            if (activeFilters.position) {
                filtered = filtered.filter(emp => emp.position === activeFilters.position);
            }
            
            // Filtr po zmianie
            if (activeFilters.shift) {
                filtered = filtered.filter(emp => emp.shift === activeFilters.shift);
            }
            
            // Wyszukiwanie
            const searchTerm = document.getElementById('search').value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(emp => {
                    // Szukaj we wszystkich polach
                    const searchableText = [
                        emp.name,
                        emp.position,
                        emp.department,
                        emp.shift || '',
                        emp.rcp ? emp.rcp.toString() : '',
                        emp.citizenship,
                        emp.locker || '',
                        formatDate(emp.hireDate)
                    ].join(' ').toLowerCase();
                    
                    return searchableText.includes(searchTerm);
                });
            }
            
            // Aktualizacja licznika filtrowanych pracowników
            const filteredCard = document.getElementById('filtered-count-card');
            const filteredCount = document.getElementById('filtered-employees');
            
            if (activeFilters.department || activeFilters.position || activeFilters.shift || searchTerm) {
                filteredCard.style.display = 'block';
                filteredCount.textContent = filtered.length;
            } else {
                filteredCard.style.display = 'none';
            }
            
            return filtered;
        }

        // Aplikowanie filtrów (wywoływane z HTML)
        function applyFilters() {
            activeFilters.department = document.getElementById('filter-department').value;
            activeFilters.position = document.getElementById('filter-position').value;
            activeFilters.shift = document.getElementById('filter-shift').value;
            renderEmployees();
        }

        // Renderowanie usuniętych pracowników - DODANA FUNKCJA TRWAŁEGO USUWANIA
        function renderDeletedEmployees() {
            const tbody = document.getElementById('deleted-tbody');
            const mobileCards = document.getElementById('deleted-mobile-cards');
            const emptyState = document.getElementById('deleted-empty');
            
            if (deletedEmployees.length === 0) {
                tbody.innerHTML = '';
                mobileCards.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Desktop view
            tbody.innerHTML = deletedEmployees.map(emp => `
                <tr>
                    <td>${emp.name}</td>
                    <td>${emp.position}</td>
                    <td>${emp.department}</td>
                    <td>${emp.shift || ''}</td>
                    <td>${emp.rcp || ''}</td>
                    <td>${emp.citizenship}</td>
                    <td>${formatDate(emp.deletedDate)}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-icon restore" onclick="restoreEmployee(${emp.id})" title="${i18n('buttons.restore')}">↩️</button>
                            <button class="btn-icon delete" onclick="permanentlyDeleteEmployee(${emp.id})" title="${i18n('buttons.permanentlyDelete')}">❌</button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Mobile view
            mobileCards.innerHTML = deletedEmployees.map(emp => `
                <div class="employee-card">
                    <div class="employee-card-header">
                        <div>
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-position" style="color: #ef4444;">${i18n('table.deleteDate')}: ${formatDate(emp.deletedDate)}</div>
                        </div>
                        <div class="card-actions">
                            <button class="btn-icon restore" onclick="restoreEmployee(${emp.id})">↩️</button>
                            <button class="btn-icon delete" onclick="permanentlyDeleteEmployee(${emp.id})">❌</button>
                        </div>
                    </div>
                    <div class="employee-details">
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.position')}:</span>
                            <span>${emp.position}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.department')}:</span>
                            <span>${emp.department}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${i18n('table.citizenship')}:</span>
                            <span>${emp.citizenship}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // NOWA FUNKCJA - Trwałe usuwanie pracownika
        function permanentlyDeleteEmployee(id) {
            if (!confirm(i18n('toast.confirmDeletePermanently'))) return;
            
            const index = deletedEmployees.findIndex(emp => emp.id === id);
            if (index === -1) return;
            
            // Usuń pracownika z listy usuniętych
            deletedEmployees.splice(index, 1);
            
            // Usuń wszystkie rekordy wydawania odzieży dla tego pracownika
            delete clothingRecords[id];
            
            saveToFirebase();
            renderDeletedEmployees();
            showToast(i18n('toast.employeePermanentlyDeleted'));
        }

        // Aktualizacja statystyk
        function updateStats() {
            document.getElementById('total-employees').textContent = employees.length;
            
            const departments = [...new Set(employees.map(emp => emp.department))];
            document.getElementById('departments-count').textContent = departments.length;
            
            const nationalities = [...new Set(employees.map(emp => emp.citizenship))];
            document.getElementById('nationalities-count').textContent = nationalities.length;
        }

        // Aktualizacja statystyk działów
        function updateDepartmentStats() {
            const container = document.getElementById('department-stats');
            const grid = document.getElementById('dept-cards-grid');
            
            if (employees.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            
            // Grupowanie pracowników po działach
            const deptGroups = {};
            employees.forEach(emp => {
                if (!deptGroups[emp.department]) {
                    deptGroups[emp.department] = {
                        count: 0,
                        positions: new Set(),
                        employees: []
                    };
                }
                deptGroups[emp.department].count++;
                deptGroups[emp.department].positions.add(emp.position);
                deptGroups[emp.department].employees.push(emp);
            });
            
            // Renderowanie kart działów
            grid.innerHTML = Object.entries(deptGroups).map(([dept, data]) => `
                <div class="dept-card" onclick="showDepartmentDetails('${dept}')">
                    <div class="dept-name">${dept}</div>
                    <div class="dept-info">
                        <div class="dept-count">${data.count}</div>
                        <div class="dept-positions">${data.positions.size} ${i18n('departments.positions')}</div>
                    </div>
                    <div class="dept-positions-list">
                        ${Array.from(data.positions).slice(0, 3).map(pos => 
                            `<span class="position-badge">${pos}</span>`
                        ).join('')}
                        ${data.positions.size > 3 ? `<span class="position-badge">+${data.positions.size - 3}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Pokazanie szczegółów działu - NOWA WERSJA
        function showDepartmentDetails(department) {
            const modal = document.getElementById('dept-modal');
            const title = document.getElementById('dept-modal-title');
            const content = document.getElementById('dept-modal-content');
            
            const deptEmployees = employees.filter(emp => emp.department === department);
            
            // Grupowanie pracowników po stanowiskach
            const positionGroups = {};
            deptEmployees.forEach(emp => {
                if (!positionGroups[emp.position]) {
                    positionGroups[emp.position] = [];
                }
                positionGroups[emp.position].push(emp);
            });
            
            title.textContent = i18n('toast.departmentDetails').replace('{department}', department);
            
            content.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <p style="color: white; font-size: 1.2rem; margin-bottom: 1rem;">
                        ${i18n('departments.employeeCount')} <strong>${deptEmployees.length}</strong>
                    </p>
                </div>
                ${Object.entries(positionGroups).map(([position, employees]) => `
                    <div class="position-section">
                        <div class="position-header">
                            <div class="position-name">${position}</div>
                            <div class="position-count">${employees.length}</div>
                        </div>
                        <div class="employee-list">
                            ${employees.map(emp => `
                                <div class="employee-item" onclick="editEmployee(${emp.id})">
                                    <div class="employee-name">${emp.name}</div>
                                    <div class="employee-date">${formatDate(emp.hireDate)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            `;
            
            modal.style.display = 'block';
        }

        // Zamknięcie modala działu
        function closeDeptModal() {
            document.getElementById('dept-modal').style.display = 'none';
        }

        // Sortowanie pracowników
        function sortEmployees(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            renderEmployees();
        }

        // Sortowanie po dacie - najnowsi
        function sortByDateNewest() {
            sortColumn = 'hireDate';
            sortDirection = 'desc';
            renderEmployees();
            
            // Aktualizacja przycisków
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Sortowanie po dacie - najstarsi
        function sortByDateOldest() {
            sortColumn = 'hireDate';
            sortDirection = 'asc';
            renderEmployees();
            
            // Aktualizacja przycisków
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Sortowanie usuniętych po dacie - najnowsi
        function sortDeletedByDateNewest() {
            deletedEmployees.sort((a, b) => new Date(b.deletedDate) - new Date(a.deletedDate));
            renderDeletedEmployees();
        }

        // Sortowanie usuniętych po dacie - najstarsi
        function sortDeletedByDateOldest() {
            deletedEmployees.sort((a, b) => new Date(a.deletedDate) - new Date(b.deletedDate));
            renderDeletedEmployees();
        }

        // Aktualizacja nagłówków tabeli
        function updateHeaders() {
            const headers = document.querySelectorAll('#employees-table th');
            headers.forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
            });
            
            if (sortColumn) {
                const columnMap = {
                    'name': 0,
                    'position': 1,
                    'department': 2,
                    'shift': 3,
                    'rcp': 4,
                    'citizenship': 5,
                    'locker': 6,
                    'hireDate': 7
                };
                
                const headerIndex = columnMap[sortColumn];
                if (headerIndex !== undefined) {
                    headers[headerIndex].classList.add(sortDirection === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            }
        }

        // Formatowanie daty
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('pl-PL');
        }

        // Edycja inline
        function makeEditable(td, employeeId, field) {
            if (td.querySelector('input')) return;
            
            const currentValue = td.textContent;
            const employee = employees.find(emp => emp.id === employeeId);
            
            let input;
            if (field === 'hireDate') {
                input = document.createElement('input');
                input.type = 'date';
                input.value = employee[field] || '';
            } else if (field === 'department') {
                input = document.createElement('select');
                input.innerHTML = `<option value="">${i18n('select.choose')}</option>`;
                systemLists.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    if (dept === currentValue) option.selected = true;
                    input.appendChild(option);
                });
            } else if (field === 'citizenship') {
                input = document.createElement('select');
                input.innerHTML = `<option value="">${i18n('select.choose')}</option>`;
                systemLists.citizenships.forEach(cit => {
                    const option = document.createElement('option');
                    option.value = cit;
                    option.textContent = cit;
                    if (cit === currentValue) option.selected = true;
                    input.appendChild(option);
                });
            } else {
                input = document.createElement('input');
                input.type = field === 'rcp' ? 'number' : 'text';
                input.value = currentValue;
            }
            
            input.className = 'edit-input';
            
            input.onblur = function() {
                const newValue = input.value.trim();
                if (newValue !== currentValue) {
                    employee[field] = newValue;
                    saveToFirebase();
                    showToast(i18n('toast.dataUpdated'));
                }
                td.textContent = field === 'hireDate' ? formatDate(newValue) : (newValue || '-');
            };
            
            input.onkeydown = function(e) {
                if (e.key === 'Enter') {
                    input.blur();
                } else if (e.key === 'Escape') {
                    td.textContent = currentValue;
                }
            };
            
            td.textContent = '';
            td.appendChild(input);
            input.focus();
            if (input.select) input.select();
        }

        // ==============================================
        // CRUD OPERATIONS
        // ==============================================

        // Dodawanie pracownika
        function addEmployee(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const employee = {
                id: generateUniqueId(),
                name: formData.get('name').toUpperCase(),
                position: formData.get('position'),
                department: formData.get('department') === 'other' ? 
                    formData.get('department-other') : formData.get('department'),
                shift: formData.get('shift'),
                rcp: formData.get('rcp'),
                citizenship: formData.get('citizenship') === 'other' ? 
                    formData.get('citizenship-other') : formData.get('citizenship'),
                locker: formData.get('locker'),
                hireDate: formData.get('hireDate')
            };
            
            employees.push(employee);
            saveToFirebase();
            
            closeAddModal();
            renderEmployees();
            showToast(i18n('toast.employeeAdded'));
        }

        // Dodawanie usuniętego pracownika - NOWA FUNKCJA
        function addDeletedEmployee(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const employee = {
                id: generateUniqueId(),
                name: formData.get('name').toUpperCase(),
                position: formData.get('position'),
                department: formData.get('department'),
                shift: formData.get('shift'),
                rcp: formData.get('rcp'),
                citizenship: formData.get('citizenship'),
                deletedDate: formData.get('deletedDate')
            };
            
            deletedEmployees.push(employee);
            saveToFirebase();
            
            closeAddDeletedModal();
            renderDeletedEmployees();
            showToast(i18n('toast.employeeAdded'));
        }

        // Otwieranie modala dodawania usuniętego pracownika
        function openAddDeletedModal() {
            updateDeletedDropdowns();
            document.getElementById('add-deleted-form').reset();
            document.getElementById('add-deleted-form').elements.deletedDate.value = new Date().toISOString().split('T')[0];
            document.getElementById('add-deleted-modal').style.display = 'block';
        }

        // Zamykanie modala dodawania usuniętego pracownika
        function closeAddDeletedModal() {
            document.getElementById('add-deleted-modal').style.display = 'none';
        }

        // Aktualizacja dropdownów dla usuniętych
        function updateDeletedDropdowns() {
            // Datalisty
            updateDatalist('deleted-position-list', systemLists.positions);
            updateDatalist('deleted-shift-list', systemLists.shifts);
            
            // Selecty
            updateSelect('deleted-department-select', systemLists.departments, false);
            updateSelect('deleted-citizenship-select', systemLists.citizenships, false);
        }

        // Edytowanie pracownika - POPRAWIONE POZYCJONOWANIE
        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            document.getElementById('edit-employee-id').value = id;
            document.getElementById('edit-name').value = employee.name;
            document.getElementById('edit-position').value = employee.position;
            document.getElementById('edit-department').value = employee.department;
            document.getElementById('edit-shift').value = employee.shift || '';
            document.getElementById('edit-rcp').value = employee.rcp || '';
            document.getElementById('edit-citizenship').value = employee.citizenship;
            document.getElementById('edit-locker').value = employee.locker || '';
            document.getElementById('edit-hireDate').value = employee.hireDate || '';
            
            updateDropdowns();
            
            // Otwórz modal
            const modal = document.getElementById('edit-modal');
            modal.style.display = 'block';
            
            // Przewiń na górę strony po małym opóźnieniu
            setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 50);
        }

        // Zapisywanie zmian pracownika
        function saveEmployee(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('edit-employee-id').value);
            const employee = employees.find(emp => emp.id === id);
            
            if (!employee) return;
            
            employee.name = document.getElementById('edit-name').value.toUpperCase();
            employee.position = document.getElementById('edit-position').value;
            employee.department = document.getElementById('edit-department').value === 'other' ? 
                document.getElementById('edit-department-other').value : 
                document.getElementById('edit-department').value;
            employee.shift = document.getElementById('edit-shift').value;
            employee.rcp = document.getElementById('edit-rcp').value;
            employee.citizenship = document.getElementById('edit-citizenship').value === 'other' ? 
                document.getElementById('edit-citizenship-other').value : 
                document.getElementById('edit-citizenship').value;
            employee.locker = document.getElementById('edit-locker').value;
            employee.hireDate = document.getElementById('edit-hireDate').value;
            
            saveToFirebase();
            closeEditModal();
            renderEmployees();
            showToast(i18n('toast.employeeUpdated'));
        }

        // Usuwanie pracownika
        function deleteEmployee(id) {
            if (!confirm(i18n('toast.confirmDelete'))) return;
            
            const index = employees.findIndex(emp => emp.id === id);
            if (index === -1) return;
            
            const employee = employees[index];
            employee.deletedDate = new Date().toISOString();
            
            deletedEmployees.push(employee);
            employees.splice(index, 1);
            
            saveToFirebase();
            renderEmployees();
            renderDeletedEmployees();
            showToast(i18n('toast.employeeDeleted'));
        }

        // Przywracanie pracownika
        function restoreEmployee(id) {
            const index = deletedEmployees.findIndex(emp => emp.id === id);
            if (index === -1) return;
            
            const employee = deletedEmployees[index];
            delete employee.deletedDate;
            
            employees.push(employee);
            deletedEmployees.splice(index, 1);
            
            saveToFirebase();
            renderEmployees();
            renderDeletedEmployees();
            showToast(i18n('toast.employeeRestored'));
        }
        
        // Usuwanie wszystkich pracowników
        function clearAllEmployees() {
            if (employees.length === 0) {
                showToast(i18n('toast.listEmpty'), 'info');
                return;
            }
            
            const message = i18n('toast.confirmDeleteAll')
                .replace('{count}', employees.length);
            
            if (confirm(message)) {
                // Dodaj drugą weryfikację dla bezpieczeństwa
                if (confirm(i18n('toast.finalWarning'))) {
                    // Przenieś wszystkich pracowników do usuniętych
                    const currentDate = new Date().toISOString();
                    employees.forEach(emp => {
                        emp.deletedDate = currentDate;
                        deletedEmployees.push(emp);
                    });
                    
                    // Wyczyść listę aktywnych pracowników
                    employees = [];
                    
                    // Wyczyść historię wydawania odzieży
                    clothingRecords = {};
                    
                    // Zapisz zmiany
                    saveToFirebase();
                    
                    // Odśwież interfejs
                    renderEmployees();
                    renderDeletedEmployees();
                    updateClothingEmployeesList();
                    updateTrainingEmployeesList();
                    updateStats();
                    
                    // Pokaż kartę informacyjną
                    const infoCard = document.getElementById('info-card');
                    if (infoCard) {
                        infoCard.style.display = 'block';
                    }
                    
                    showToast(i18n('toast.allDeleted'));
                }
            }
        }

        // ==============================================
        // MODAL FUNCTIONS
        // ==============================================

        function openAddModal() {
            updateDropdowns();
            document.getElementById('add-form').reset();
            document.getElementById('add-form').elements.hireDate.value = new Date().toISOString().split('T')[0];
            document.getElementById('add-modal').style.display = 'block';
        }

        function closeAddModal() {
            document.getElementById('add-modal').style.display = 'none';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        // ==============================================
        // CLOTHING MANAGEMENT
        // ==============================================

        function updateClothingEmployeesList() {
            const select = document.getElementById('clothing-employee-select');
            select.innerHTML = `<option value="">${i18n('select.employee')}</option>`;
            
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.name} - ${emp.department}`;
                select.appendChild(option);
            });
        }

        function loadEmployeeClothingData() {
            const employeeId = document.getElementById('clothing-employee-select').value;
            
            if (!employeeId) {
                document.getElementById('employee-clothing-card').style.display = 'none';
                document.getElementById('employee-clothing-card-mobile').style.display = 'none';
                return;
            }
            
            const employee = employees.find(emp => emp.id == employeeId);
            if (!employee) return;
            
            // Desktop view
            document.getElementById('employee-clothing-card').style.display = 'block';
            document.getElementById('clothing-employee-name').textContent = employee.name;
            document.getElementById('clothing-employee-position').textContent = employee.position;
            document.getElementById('clothing-employee-department').textContent = employee.department;
            
            // Mobile view
            document.getElementById('employee-clothing-card-mobile').style.display = 'block';
            document.getElementById('clothing-employee-name-mobile').textContent = employee.name;
            document.getElementById('clothing-employee-position-mobile').textContent = employee.position;
            document.getElementById('clothing-employee-department-mobile').textContent = employee.department;
            
            // Historia wydawania
            const history = clothingRecords[employeeId] || [];
            const lastIssue = history.length > 0 ? history[history.length - 1].date : null;
            
            document.getElementById('clothing-last-issue-date').textContent = lastIssue ? formatDate(lastIssue) : '-';
            document.getElementById('clothing-last-issue-date-mobile').textContent = lastIssue ? formatDate(lastIssue) : '-';
            
            const historyHtml = history.length > 0 ? 
                history.map((record, index) => `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 10px; margin-bottom: 0.75rem;">
                        <p style="color: white; margin: 0 0 0.5rem 0;">
                            <strong>${i18n('clothing.issueDateLabel')}</strong> ${formatDate(record.date)}
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.8); margin: 0 0 0.5rem 0;">
                            <strong>${i18n('clothing.issuedItems')}</strong> ${record.items.join(', ')}
                        </p>
                        ${record.notes ? `<p style="color: rgba(255, 255, 255, 0.7); margin: 0;"><strong>${i18n('clothing.notes')}</strong> ${record.notes}</p>` : ''}
                        <button class="btn-icon delete" onclick="removeClothingRecord(${employeeId}, ${index})" 
                                style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            🗑️ ${i18n('clothing.deleteEntry')}
                        </button>
                    </div>
                `).join('') : 
                `<p style="color: rgba(255, 255, 255, 0.5); text-align: center;">${i18n('clothing.noHistory')}</p>`;
            
            document.getElementById('clothing-history').innerHTML = historyHtml;
            document.getElementById('clothing-history-mobile').innerHTML = 
                history.length > 0 ? `${i18n('clothing.history')} ${history.length}` : i18n('clothing.noHistory');
        }

        function openClothingIssueModal() {
            const employeeId = document.getElementById('clothing-employee-select').value;
            
            if (!employeeId) {
                showToast(i18n('toast.selectEmployee'), 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id == employeeId);
            
            document.getElementById('modal-employee-name').textContent = employee.name;
            document.getElementById('modal-employee-department').textContent = employee.department;
            document.getElementById('modal-employee-position').textContent = employee.position;
            
            // Generowanie checkboxów
            const checkboxesContainer = document.getElementById('clothing-checkboxes');
            checkboxesContainer.innerHTML = systemLists.clothingItems.map(item => `
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="clothingItem" value="${item}" 
                           style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="color: white;">${item}</span>
                </label>
            `).join('');
            
            document.getElementById('clothing-issue-form').reset();
            document.getElementById('clothing-issue-form').elements.issueDate.value = 
                new Date().toISOString().split('T')[0];
            
            document.getElementById('clothing-issue-modal').style.display = 'block';
        }

        function closeClothingIssueModal() {
            document.getElementById('clothing-issue-modal').style.display = 'none';
        }

        function issueClothing(event) {
            event.preventDefault();
            
            const employeeId = document.getElementById('clothing-employee-select').value;
            const formData = new FormData(event.target);
            
            const selectedItems = [];
            document.querySelectorAll('input[name="clothingItem"]:checked').forEach(checkbox => {
                selectedItems.push(checkbox.value);
            });
            
            if (selectedItems.length === 0) {
                showToast(i18n('toast.selectAtLeastOne'), 'error');
                return;
            }
            
            const record = {
                date: formData.get('issueDate'),
                items: selectedItems,
                notes: formData.get('notes')
            };
            
            if (!clothingRecords[employeeId]) {
                clothingRecords[employeeId] = [];
            }
            
            clothingRecords[employeeId].push(record);
            saveToFirebase();
            
            closeClothingIssueModal();
            loadEmployeeClothingData();
            showToast(i18n('toast.clothingIssued'));
        }

        function removeClothingRecord(employeeId, recordIndex) {
            if (!confirm(i18n('toast.confirmDeleteEntry'))) return;
            
            clothingRecords[employeeId].splice(recordIndex, 1);
            
            if (clothingRecords[employeeId].length === 0) {
                delete clothingRecords[employeeId];
            }
            
            saveToFirebase();
            loadEmployeeClothingData();
            showToast(i18n('toast.entryDeleted'));
        }

        // Funkcja drukowania karty odzieży - NAPRAWIONA
        function printClothingRecord() {
            const employeeId = document.getElementById('clothing-employee-select').value;
            
            if (!employeeId) {
                showToast(i18n('toast.selectEmployee'), 'error');
                return;
            }
            
            // Dodaj klasę do body podczas drukowania
            document.body.classList.add('printing-mode');
            
            // Drukuj
            window.print();
            
            // Usuń klasę po drukowaniu
            setTimeout(() => {
                document.body.classList.remove('printing-mode');
            }, 100);
        }

        // ==============================================
        // SETTINGS MANAGEMENT
        // ==============================================

        function renderSettingsLists() {
            // Działy
            document.getElementById('departments-list').innerHTML = 
                systemLists.departments.map(dept => `
                    <div class="settings-item">
                        <input type="text" value="${dept}" 
                               onchange="updateListItem('departments', ${systemLists.departments.indexOf(dept)}, this.value)">
                        <div class="settings-item-actions">
                            <button class="btn-icon delete" onclick="removeListItem('departments', ${systemLists.departments.indexOf(dept)})">🗑️</button>
                        </div>
                    </div>
                `).join('');
            
            // Stanowiska
            document.getElementById('positions-list').innerHTML = 
                systemLists.positions.map(pos => `
                    <div class="settings-item">
                        <input type="text" value="${pos}" 
                               onchange="updateListItem('positions', ${systemLists.positions.indexOf(pos)}, this.value)">
                        <div class="settings-item-actions">
                            <button class="btn-icon delete" onclick="removeListItem('positions', ${systemLists.positions.indexOf(pos)})">🗑️</button>
                        </div>
                    </div>
                `).join('');
            
            // Zmiany
            document.getElementById('shifts-list').innerHTML = 
                systemLists.shifts.map(shift => `
                    <div class="settings-item">
                        <input type="text" value="${shift}" 
                               onchange="updateListItem('shifts', ${systemLists.shifts.indexOf(shift)}, this.value)">
                        <div class="settings-item-actions">
                            <button class="btn-icon delete" onclick="removeListItem('shifts', ${systemLists.shifts.indexOf(shift)})">🗑️</button>
                        </div>
                    </div>
                `).join('');
            
            // Obywatelstwa
            document.getElementById('citizenships-list').innerHTML = 
                systemLists.citizenships.map(cit => `
                    <div class="settings-item">
                        <input type="text" value="${cit}" 
                               onchange="updateListItem('citizenships', ${systemLists.citizenships.indexOf(cit)}, this.value)">
                        <div class="settings-item-actions">
                            <button class="btn-icon delete" onclick="removeListItem('citizenships', ${systemLists.citizenships.indexOf(cit)})">🗑️</button>
                        </div>
                    </div>
                `).join('');
            
            // Elementy odzieży
            document.getElementById('clothing-items-list').innerHTML = 
                systemLists.clothingItems.map(item => `
                    <div class="settings-item">
                        <input type="text" value="${item}" 
                               onchange="updateListItem('clothingItems', ${systemLists.clothingItems.indexOf(item)}, this.value)">
                        <div class="settings-item-actions">
                            <button class="btn-icon delete" onclick="removeListItem('clothingItems', ${systemLists.clothingItems.indexOf(item)})">🗑️</button>
                        </div>
                    </div>
                `).join('');
        }

        function updateListItem(listName, index, newValue) {
            systemLists[listName][index] = newValue;
            saveToFirebase();
            updateDropdowns();
            showToast(i18n('toast.updated'));
        }

        function removeListItem(listName, index) {
            if (!confirm(i18n('toast.confirmDeleteItem'))) return;
            
            systemLists[listName].splice(index, 1);
            saveToFirebase();
            renderSettingsLists();
            updateDropdowns();
            showToast(i18n('toast.deleted'));
        }

        function addDepartment() {
            const input = document.getElementById('new-department');
            const value = input.value.trim();
            
            if (!value) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            systemLists.departments.push(value);
            saveToFirebase();
            renderSettingsLists();
            updateDropdowns();
            input.value = '';
            showToast(i18n('toast.added'));
        }

        function addPosition() {
            const input = document.getElementById('new-position');
            const value = input.value.trim();
            
            if (!value) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            systemLists.positions.push(value);
            saveToFirebase();
            renderSettingsLists();
            updateDropdowns();
            input.value = '';
            showToast(i18n('toast.added'));
        }

        function addShift() {
            const input = document.getElementById('new-shift');
            const value = input.value.trim();
            
            if (!value) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            systemLists.shifts.push(value);
            saveToFirebase();
            renderSettingsLists();
            updateDropdowns();
            input.value = '';
            showToast(i18n('toast.added'));
        }

        function addCitizenship() {
            const input = document.getElementById('new-citizenship');
            const value = input.value.trim();
            
            if (!value) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            systemLists.citizenships.push(value);
            saveToFirebase();
            renderSettingsLists();
            updateDropdowns();
            input.value = '';
            showToast(i18n('toast.added'));
        }

        function addClothingItem() {
            const input = document.getElementById('new-clothing-item');
            const value = input.value.trim();
            
            if (!value) {
                showToast(i18n('toast.enterValue'), 'error');
                return;
            }
            
            systemLists.clothingItems.push(value);
            saveToFirebase();
            renderSettingsLists();
            input.value = '';
            showToast(i18n('toast.added'));
        }

        // ==============================================
        // EXCEL IMPORT/EXPORT
        // ==============================================

        function exportToExcel() {
            const ws_data = [
                [i18n('table.name'), i18n('table.position'), i18n('table.department'), i18n('table.shift'), i18n('table.rcp'), i18n('table.citizenship'), i18n('table.locker'), i18n('table.hireDate')]
            ];
            
            employees.forEach(emp => {
                ws_data.push([
                    emp.name,
                    emp.position,
                    emp.department,
                    emp.shift || '',
                    emp.rcp || '',
                    emp.citizenship,
                    emp.locker || '',
                    emp.hireDate || ''
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Pracownicy");
            
            XLSX.writeFile(wb, `pracownicy_${new Date().toISOString().split('T')[0]}.xlsx`);
            showToast(i18n('toast.exported'));
        }

        function createSampleExcel() {
            const sampleData = [
                ['Nazwisko,Imię', 'Stanowisko', 'Dział', 'Zmiana', 'RCP', 'Obywatelstwo', 'Szafka', 'Data przyjęcia'],
                ['KOWALSKI JAN', 'Spawacz MIG/MAG', 'DZIAŁ_SPAWALNIA_PL', 'Adam Nowak', '5286', 'polskie', 'K92', '2024-01-15'],
                ['SHEVCHENKO IVAN', 'Operator robota', 'DZIAŁ_SPAWALNIA_UA_ROBOT', 'HRABKO VIACHESLAV', '5287', 'ukraińskie', 'M45', '2024-02-20'],
                ['NOWAK ANNA', 'Kontroler jakości', 'DZIAŁ_KONTROLA_JAKOŚCI', 'Katarzyna Krzyżanek', '5288', 'polskie', 'Q12', '2024-03-10']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(sampleData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Przykład");
            
            XLSX.writeFile(wb, "przyklad_import_pracownikow.xlsx");
            showToast(i18n('toast.exported'));
        }

        // ==============================================
        // JSON IMPORT/EXPORT
        // ==============================================

        function exportToJSON() {
            const data = {
                employees: employees,
                deletedEmployees: deletedEmployees,
                clothingRecords: clothingRecords,
                positionClothesMapping: positionClothesMapping,
                systemLists: systemLists,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_hr_system_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast(i18n('toast.exported'));
        }

        function importFromJSON(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.employees || !Array.isArray(data.employees)) {
                        throw new Error('Nieprawidłowy format pliku');
                    }
                    
                    if (confirm(i18n('toast.confirmReplaceData'))) {
                        employees = data.employees || [];
                        deletedEmployees = data.deletedEmployees || [];
                        clothingRecords = data.clothingRecords || {};
                        positionClothesMapping = data.positionClothesMapping || {...defaultPositionClothesMapping};
                        systemLists = data.systemLists || systemLists;
                        
                        // Znajdź najwyższe ID
                        let maxId = 0;
                        [...employees, ...deletedEmployees].forEach(emp => {
                            if (emp.id > maxId) maxId = emp.id;
                        });
                        nextEmployeeId = maxId + 1;
                        
                        saveToFirebase();
                        renderEmployees();
                        renderDeletedEmployees();
                        updateClothingEmployeesList();
                        updateTrainingEmployeesList();
                        renderSettingsLists();
                        renderPositionClothesMapping();
                        updateStats();
                        updateDropdowns();
                        
                        showToast(i18n('toast.imported'));
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showToast(i18n('toast.importError') + ' ' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // ==============================================
        // UI HELPERS
        // ==============================================

        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9))';
            } else if (type === 'info') {
                toast.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.9))';
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        function updateDropdowns() {
            // Filtry
            const filterDept = document.getElementById('filter-department');
            const filterPos = document.getElementById('filter-position');
            const filterShift = document.getElementById('filter-shift');
            
            if (filterDept) {
                const currentDeptFilter = filterDept.value;
                filterDept.innerHTML = `<option value="">${i18n('filters.allDepartments')}</option>`;
                systemLists.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    if (dept === currentDeptFilter) option.selected = true;
                    filterDept.appendChild(option);
                });
            }
            
            if (filterPos) {
                const currentPosFilter = filterPos.value;
                filterPos.innerHTML = `<option value="">${i18n('filters.allPositions')}</option>`;
                systemLists.positions.forEach(pos => {
                    const option = document.createElement('option');
                    option.value = pos;
                    option.textContent = pos;
                    if (pos === currentPosFilter) option.selected = true;
                    filterPos.appendChild(option);
                });
            }
            
            if (filterShift) {
                const currentShiftFilter = filterShift.value;
                filterShift.innerHTML = `<option value="">${i18n('filters.allShifts')}</option>`;
                systemLists.shifts.forEach(shift => {
                    const option = document.createElement('option');
                    option.value = shift;
                    option.textContent = shift;
                    if (shift === currentShiftFilter) option.selected = true;
                    filterShift.appendChild(option);
                });
            }
            
            // Datalisty dla formularzy
            updateDatalist('position-list', systemLists.positions);
            updateDatalist('shift-list', systemLists.shifts);
            updateDatalist('edit-position-list', systemLists.positions);
            updateDatalist('edit-shift-list', systemLists.shifts);
            
            // Selecty w formularzach
            updateSelect('department-select', systemLists.departments, true);
            updateSelect('citizenship-select', systemLists.citizenships, true);
            updateSelect('edit-department', systemLists.departments, true);
            updateSelect('edit-citizenship', systemLists.citizenships, true);
        }

        function updateDatalist(id, items) {
            const datalist = document.getElementById(id);
            if (!datalist) return;
            
            datalist.innerHTML = items.map(item => 
                `<option value="${item}">`
            ).join('');
        }

        function updateSelect(id, items, addOther = false) {
            const select = document.getElementById(id);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = `<option value="">${i18n('select.choose')}</option>`;
            
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                if (item === currentValue) option.selected = true;
                select.appendChild(option);
            });
            
            if (addOther) {
                const option = document.createElement('option');
                option.value = 'other';
                option.textContent = i18n('select.other');
                if (currentValue === 'other') option.selected = true;
                select.appendChild(option);
            }
        }

        // ==============================================
        // EVENT LISTENERS
        // ==============================================
        
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Obsługa zmiany zakładek
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (this.onclick) return; // Skip if has onclick
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabName = this.dataset.tab;
                    document.getElementById(tabName).classList.add('active');
                    
                    // Update lists when switching tabs
                    if (tabName === 'clothing') {
                        updateClothingEmployeesList();
                    } else if (tabName === 'training-clothes') {
                        updateTrainingEmployeesList();
                    } else if (tabName === 'settings') {
                        renderSettingsLists();
                        renderPositionClothesMapping();
                    }
                });
            });

            // Wyszukiwanie
            const searchInput = document.getElementById('search');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    renderEmployees();
                });
                
                // Dodaj obsługę wyszukiwania na urządzeniach mobilnych
                searchInput.addEventListener('search', function() {
                    renderEmployees();
                });
                
                // Obsługa czyszczenia pola wyszukiwania
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Escape') {
                        this.value = '';
                        renderEmployees();
                    }
                });
            }

            // Import Excel
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
                console.log('Adding file input listener...');
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    console.log('Import Excel - file selected:', file.name);
                    showToast(i18n('toast.loadingFile'), 'info');
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                            
                            console.log('Excel data loaded:', jsonData);
                            
                            if (jsonData.length < 2) {
                                showToast(i18n('toast.emptyFile'), 'error');
                                return;
                            }
                            
                            const headers = jsonData[0];
                            const rows = jsonData.slice(1);
                            
                            // Mapowanie kolumn - sprawdzamy różne możliwe nazwy kolumn
                            const columnMap = {
                                name: findColumnIndex(headers, ['Nazwisko,Imię', 'Nazwisko, Imię', 'Nazwisko i Imię', 'Imię i Nazwisko', 'Name', 'Pracownik', 'Last Name,First Name', 'Прізвище,Ім\'я', 'Apellido,Nombre']),
                                position: findColumnIndex(headers, ['Stanowisko', 'Position', 'Funkcja', 'Posada', 'Posición']),
                                department: findColumnIndex(headers, ['Dział', 'Department', 'Wydział', 'Відділ', 'Departamento']),
                                shift: findColumnIndex(headers, ['Zmiana', 'Shift', 'Kierownik', 'Zmiana/Kierownik', 'Зміна', 'Turno']),
                                rcp: findColumnIndex(headers, ['RCP', 'Rcp', 'Numer RCP']),
                                citizenship: findColumnIndex(headers, ['Obywatelstwo', 'Citizenship', 'Narodowość', 'Громадянство', 'Ciudadanía']),
                                locker: findColumnIndex(headers, ['Szafka', 'Locker', 'Nr szafki', 'Шафка', 'Casillero']),
                                hireDate: findColumnIndex(headers, ['Data przyjęcia', 'Data zatrudnienia', 'Hire Date', 'Data', 'Дата прийняття', 'Fecha de Contratación'])
                            };
                            
                            console.log('Column mapping:', columnMap);
                            
                            const newEmployees = [];
                            let skippedRows = 0;
                            
                            rows.forEach((row, index) => {
                                // Sprawdzamy czy wiersz ma jakiekolwiek dane
                                if (!row || row.length === 0 || !row[columnMap.name]) {
                                    skippedRows++;
                                    return;
                                }
                                
                                const emp = {
                                    id: generateUniqueId(),
                                    name: (row[columnMap.name] || '').toString().trim().toUpperCase(),
                                    position: (row[columnMap.position] || '').toString().trim(),
                                    department: (row[columnMap.department] || '').toString().trim(),
                                    shift: columnMap.shift !== -1 ? (row[columnMap.shift] || '').toString().trim() : '',
                                    rcp: columnMap.rcp !== -1 ? (row[columnMap.rcp] || '').toString().trim() : '',
                                    citizenship: (row[columnMap.citizenship] || '').toString().trim(),
                                    locker: columnMap.locker !== -1 ? (row[columnMap.locker] || '').toString().trim() : '',
                                    hireDate: columnMap.hireDate !== -1 && row[columnMap.hireDate] ? formatExcelDate(row[columnMap.hireDate]) : ''
                                };
                                
                                // Walidacja - wymagane pola
                                if (!emp.name || !emp.position || !emp.department || !emp.citizenship) {
                                    console.warn(`Skipping row ${index + 2} - missing required fields:`, emp);
                                    skippedRows++;
                                    return;
                                }
                                
                                newEmployees.push(emp);
                            });
                            
                            console.log(`Processed ${newEmployees.length} employees, skipped ${skippedRows} rows`);
                            
                            if (newEmployees.length === 0) {
                                showToast(i18n('toast.noValidData'), 'error');
                                return;
                            }
                            
                            // Opcja zastąpienia lub dodania
                            const message = employees.length > 0 
                                ? i18n('toast.confirmReplace').replace('{count}', newEmployees.length)
                                : i18n('toast.foundEmployees').replace('{count}', newEmployees.length) + ' ' + i18n('toast.confirmImport');
                            
                            if (confirm(message)) {
                                employees = [...employees, ...newEmployees];
                                
                                // Aktualizacja list systemowych na podstawie importowanych danych
                                updateSystemListsFromImport(newEmployees);
                                
                                saveToFirebase();
                                renderEmployees();
                                updateClothingEmployeesList();
                                updateTrainingEmployeesList();
                                updateDropdowns();
                                
                                // Ukryj kartę informacyjną
                                const infoCard = document.getElementById('info-card');
                                if (infoCard) {
                                    infoCard.style.display = 'none';
                                }
                                
                                showToast(i18n('toast.importedCount').replace('{count}', newEmployees.length));
                            }
                        } catch (error) {
                            console.error('Import error:', error);
                            showToast(i18n('toast.importError') + ' ' + error.message, 'error');
                        }
                    };
                    
                    reader.onerror = function(error) {
                        console.error('File read error:', error);
                        showToast(i18n('toast.fileReadError'), 'error');
                    };
                    
                    reader.readAsArrayBuffer(file);
                    e.target.value = ''; // Reset input
                });
            } else {
                console.error('File input not found!');
            }

            // Obsługa selectów w formularzach
            const deptSelect = document.getElementById('department-select');
            if (deptSelect) {
                deptSelect.addEventListener('change', function() {
                    const otherInput = document.getElementById('department-other');
                    otherInput.style.display = this.value === 'other' ? 'block' : 'none';
                    if (this.value !== 'other') otherInput.value = '';
                });
            }

            const citizenSelect = document.getElementById('citizenship-select');
            if (citizenSelect) {
                citizenSelect.addEventListener('change', function() {
                    const otherInput = document.getElementById('citizenship-other');
                    otherInput.style.display = this.value === 'other' ? 'block' : 'none';
                    if (this.value !== 'other') otherInput.value = '';
                });
            }

            const editDept = document.getElementById('edit-department');
            if (editDept) {
                editDept.addEventListener('change', function() {
                    const otherInput = document.getElementById('edit-department-other');
                    otherInput.style.display = this.value === 'other' ? 'block' : 'none';
                    if (this.value !== 'other') otherInput.value = '';
                });
            }

            const editCitizen = document.getElementById('edit-citizenship');
            if (editCitizen) {
                editCitizen.addEventListener('change', function() {
                    const otherInput = document.getElementById('edit-citizenship-other');
                    otherInput.style.display = this.value === 'other' ? 'block' : 'none';
                    if (this.value !== 'other') otherInput.value = '';
                });
            }

            // Drag & Drop
            let dragCounter = 0;

            document.addEventListener('dragenter', function(e) {
                e.preventDefault();
                dragCounter++;
                document.getElementById('drop-zone').classList.add('active');
            });

            document.addEventListener('dragleave', function(e) {
                dragCounter--;
                if (dragCounter === 0) {
                    document.getElementById('drop-zone').classList.remove('active');
                }
            });

            document.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            document.addEventListener('drop', function(e) {
                e.preventDefault();
                dragCounter = 0;
                document.getElementById('drop-zone').classList.remove('active');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && (files[0].name.endsWith('.xlsx') || files[0].name.endsWith('.xls'))) {
                    document.getElementById('file-input').files = files;
                    const event = new Event('change', { bubbles: true });
                    document.getElementById('file-input').dispatchEvent(event);
                } else {
                    showToast(i18n('toast.wrongFormat'), 'error');
                }
            });

            // Zamykanie modali po kliknięciu poza nimi
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            };
            
            console.log('Event listeners setup complete');
        }
        
        // Funkcja pomocnicza do znajdowania indeksu kolumny
        function findColumnIndex(headers, possibleNames) {
            for (let i = 0; i < headers.length; i++) {
                const header = (headers[i] || '').toString().trim();
                for (const name of possibleNames) {
                    if (header.toLowerCase() === name.toLowerCase()) {
                        return i;
                    }
                }
            }
            return -1;
        }
        
        // Funkcja do aktualizacji list systemowych na podstawie importu
        function updateSystemListsFromImport(importedEmployees) {
            importedEmployees.forEach(emp => {
                // Dodaj nowe działy
                if (emp.department && !systemLists.departments.includes(emp.department)) {
                    systemLists.departments.push(emp.department);
                }
                
                // Dodaj nowe stanowiska
                if (emp.position && !systemLists.positions.includes(emp.position)) {
                    systemLists.positions.push(emp.position);
                }
                
                // Dodaj nowe zmiany/kierowników
                if (emp.shift && !systemLists.shifts.includes(emp.shift)) {
                    systemLists.shifts.push(emp.shift);
                }
                
                // Dodaj nowe obywatelstwa
                if (emp.citizenship && !systemLists.citizenships.includes(emp.citizenship)) {
                    systemLists.citizenships.push(emp.citizenship);
                }
            });
        }

        // Mobile menu
        function showMobileMenu() {
            // Implementacja menu mobilnego
            showToast('Menu mobilne w przygotowaniu');
        }
        
        // Clear search
        function clearSearch() {
            const searchInput = document.getElementById('search');
            if (searchInput) {
                searchInput.value = '';
                renderEmployees();
                searchInput.focus();
            }
        }
        
        // Force data refresh (for mobile)
        function forceDataRefresh() {
            if (!currentUser || !dbRef) {
                showToast(i18n('toast.loginRequired'), 'error');
                return;
            }
            
            console.log('Forcing data refresh...');
            updateSyncStatus('syncing');
            showToast(i18n('toast.refreshing'), 'info');
            
            // Force offline/online cycle
            database.goOffline();
            setTimeout(() => {
                database.goOnline();
                
                // Force reload data
                dbRef.once('value').then((snapshot) => {
                    const data = snapshot.val() || {};
                    console.log('Force refresh - data received:', Object.keys(data));
                    
                    // Manually trigger data update
                    employees = data.employees || [];
                    deletedEmployees = data.deletedEmployees || [];
                    clothingRecords = data.clothingRecords || {};
                    
                    // Desanityzacja kluczy w positionClothesMapping
                    const loadedMapping = data.positionClothesMapping || {};
                    positionClothesMapping = {};
                    Object.keys(loadedMapping).forEach(sanitizedKey => {
                        let originalKey = sanitizedKey;
                        if (sanitizedKey === 'Spawacz MIG_MAG') {
                            originalKey = 'Spawacz MIG/MAG';
                        }
                        positionClothesMapping[originalKey] = loadedMapping[sanitizedKey];
                    });
                    
                    if (Object.keys(positionClothesMapping).length === 0) {
                        positionClothesMapping = {
                            'Spawacz MIG/MAG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
                            'Spawacz TIG': ['buty', 'spodnie', 'bluza', 'rękawice spawalnicze', 'przyłbica spawalnicza'],
                            'Operator robota': ['buty', 'spodnie', 'bluza', 'okulary ochronne'],
                            'Szlifierz': ['buty', 'spodnie', 'bluza', 'okulary ochronne', 'maska przeciwpyłowa'],
                            'Monter': ['buty', 'spodnie', 'bluza', 'rękawice montażowe'],
                            'Kontroler jakości': ['buty', 'spodnie', 'bluza']
                        };
                    }
                    
                    systemLists = data.systemLists || systemLists;
                    nextEmployeeId = data.nextEmployeeId || 1;
                    
                    // Force UI update
                    renderEmployees();
                    updateStats();
                    renderDeletedEmployees();
                    updateClothingEmployeesList();
                    updateTrainingEmployeesList();
                    renderSettingsLists();
                    renderPositionClothesMapping();
                    updateDropdowns();
                    
                    const infoCard = document.getElementById('info-card');
                    if (infoCard) {
                        infoCard.style.display = employees.length > 0 ? 'none' : 'block';
                    }
                    
                    updateSyncStatus('synced');
                    showToast(i18n('toast.dataRefreshed'), 'success');
                }).catch((error) => {
                    console.error('Force refresh error:', error);
                    updateSyncStatus('error');
                    showToast(i18n('toast.refreshError') + ' ' + error.message, 'error');
                });
            }, 500);
        }

        // Pomocnicza funkcja do formatowania daty z Excel
        function formatExcelDate(excelDate) {
            // Jeśli to już jest string w formacie daty, zwróć bez zmian
            if (typeof excelDate === 'string') {
                // Sprawdź czy to jest data w formacie YYYY-MM-DD
                if (/^\d{4}-\d{2}-\d{2}$/.test(excelDate)) {
                    return excelDate;
                }
                // Sprawdź czy to jest data w formacie DD.MM.YYYY lub DD/MM/YYYY
                if (/^\d{1,2}[.\/]\d{1,2}[.\/]\d{4}$/.test(excelDate)) {
                    const parts = excelDate.split(/[.\/]/);
                    const day = parts[0].padStart(2, '0');
                    const month = parts[1].padStart(2, '0');
                    const year = parts[2];
                    return `${year}-${month}-${day}`;
                }
                // Próbuj sparsować jako datę
                const date = new Date(excelDate);
                if (!isNaN(date)) {
                    return date.toISOString().split('T')[0];
                }
                return '';
            }
            
            // Jeśli to liczba (Excel serial date)
            if (typeof excelDate === 'number') {
                // Excel przechowuje daty jako liczby dni od 1900-01-01
                // ale z błędem dla lat przestępnych przed 1900-03-01
                let date;
                if (excelDate > 59) {
                    // Po 28 lutego 1900 (Excel błędnie traktuje 1900 jako rok przestępny)
                    date = new Date((excelDate - 25569) * 86400 * 1000);
                } else {
                    // Przed 1 marca 1900
                    date = new Date((excelDate - 25568) * 86400 * 1000);
                }
                
                // Sprawdź czy data jest prawidłowa
                if (!isNaN(date)) {
                    // Korekcja strefy czasowej
                    const offset = date.getTimezoneOffset();
                    date = new Date(date.getTime() + offset * 60 * 1000);
                    return date.toISOString().split('T')[0];
                }
            }
            
            return '';
        }

        // ==============================================
        // INITIALIZATION
        // ==============================================
        
        // Debug info
        console.log('HR System starting...');
        console.log('Firebase config loaded');
        
        // Mobile-specific event handlers
        function setupMobileHandlers() {
            // Handle app resume/focus
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && currentUser) {
                    console.log('App resumed/focused - refreshing data');
                    // Force reconnection
                    database.goOffline();
                    setTimeout(() => {
                        database.goOnline();
                        if (dbRef) {
                            dbRef.once('value').then((snapshot) => {
                                console.log('Data refreshed after resume');
                            });
                        }
                    }, 500);
                }
            });
            
            // Handle online/offline events
            window.addEventListener('online', function() {
                console.log('Device is online');
                updateSyncStatus('syncing');
                if (currentUser && dbRef) {
                    database.goOnline();
                    dbRef.once('value').then(() => {
                        console.log('Data synced after coming online');
                    });
                }
            });
            
            window.addEventListener('offline', function() {
                console.log('Device is offline');
                updateSyncStatus('offline');
            });
            
            // iOS specific - handle app becoming active
            window.addEventListener('focus', function() {
                if (currentUser && dbRef) {
                    console.log('Window focused - checking connection');
                    database.ref('.info/connected').once('value');
                }
            });
            
            // Prevent iOS bounce effect
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.modal') || e.target.closest('.table-wrapper')) {
                    return; // Allow scrolling in modals and tables
                }
                if (document.body.scrollHeight <= window.innerHeight) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            
            // Test XLSX library
            if (typeof XLSX !== 'undefined') {
                console.log('XLSX library loaded successfully');
            } else {
                console.error('XLSX library not loaded!');
            }
            
            // Set language from localStorage
            const savedLang = localStorage.getItem('appLanguage') || 'pl';
            changeLanguage(savedLang);
            
            // Setup mobile handlers
            setupMobileHandlers();
            
            // Add viewport meta tag for better mobile support
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
            }
            
            // Force initial auth check
            setTimeout(() => {
                if (!currentUser) {
                    console.log('No user after 3 seconds, forcing auth check');
                    const user = auth.currentUser;
                    if (user) {
                        console.log('Found current user:', user.email);
                    }
                }
            }, 3000);
        });
    </script>

<script>
// Збереження даних у Firebase після імпорту
function saveExportedDataToFirebase(dataArray) {
    const user = firebase.auth().currentUser;
    if (!user) {
        console.warn("Nie jesteś zalogowany – brak możliwości zapisu");
        return;
    }

    const uid = user.uid;
    const timestamp = new Date().toISOString();
    const ref = firebase.database().ref(`users/${uid}/lastExportedData`);

    ref.set({
        savedAt: timestamp,
        data: dataArray
    })
    .then(() => {
        console.log("Dane zostały zapisane w Firebase");
    })
    .catch((error) => {
        console.error("Błąd zapisu do Firebase:", error);
    });
}

// Відновлення даних при завантаженні сторінки, якщо оригінальний файл зник
function loadExportedDataFromFirebase() {
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            const uid = user.uid;
            const ref = firebase.database().ref(`users/${uid}/lastExportedData`);

            ref.once("value")
                .then((snapshot) => {
                    const saved = snapshot.val();
                    if (saved && saved.data) {
                        console.log("Załadowano dane z Firebase:", saved);
                        renderImportedData(saved.data); // 🔁 Твоя функція для виводу
                    } else {
                        console.log("Brak zapisanych danych w Firebase.");
                    }
                })
                .catch((error) => {
                    console.error("Błąd przy pobieraniu danych z Firebase:", error);
                });
        } else {
            console.log("Użytkownik niezalogowany.");
        }
    });
}

// Виклик при завантаженні
window.addEventListener('DOMContentLoaded', loadExportedDataFromFirebase);
</script>


<script>
// Реєстрація нового користувача при першому вході
function registerNewUserWithEmail(email, password) {
    firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            console.log("Zarejestrowano nowego użytkownika:", userCredential.user);
            showMainApp();
        })
        .catch((error) => {
            if (error.code === 'auth/email-already-in-use') {
                loginExistingUser(email, password);
            } else {
                console.error("Błąd rejestracji:", error);
                alert("Błąd: " + error.message);
            }
        });
}

// Логін користувача, якщо вже зареєстрований
function loginExistingUser(email, password) {
    firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            console.log("Zalogowano użytkownika:", userCredential.user);
            showMainApp();
        })
        .catch((error) => {
            console.error("Błąd logowania:", error);
            alert("Błąd: " + error.message);
        });
}

// Вихід з акаунту
function logout() {
    firebase.auth().signOut()
        .then(() => {
            console.log("Wylogowano pomyślnie");
            window.location.reload();
        })
        .catch((error) => {
            console.error("Błąd podczas wylogowania:", error);
        });
}

// Обробка першого входу
function handleFirstLogin(event) {
    event.preventDefault();
    const email = document.getElementById("first-login-email").value;
    const password = document.getElementById("first-login-password").value;

    if (!email || !password) {
        alert("Wpisz email i hasło");
        return;
    }

    registerNewUserWithEmail(email, password);
}

// Відображення форми логіну
function showLoginForm() {
    const loginPanel = document.getElementById("login-panel");
    const mainApp = document.getElementById("main-app");
    if (loginPanel && mainApp) {
        loginPanel.style.display = "block";
        mainApp.style.display = "none";
        loginPanel.innerHTML = `
            <h2 style="text-align: center; color: white; margin-bottom: 2rem;">Zaloguj się lub Zarejestruj</h2>
            <form class="login-form" onsubmit="handleFirstLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="first-login-email" class="form-input" required />
                </div>
                <div class="form-group">
                    <label class="form-label">Hasło</label>
                    <input type="password" id="first-login-password" class="form-input" required />
                </div>
                <button type="submit" class="btn btn-primary">Zaloguj / Zarejestruj</button>
            </form>
        `;
    }
}

// Відображення головного інтерфейсу після логіну
function showMainApp() {
    const loginPanel = document.getElementById("login-panel");
    const mainApp = document.getElementById("main-app");
    if (loginPanel && mainApp) {
        loginPanel.style.display = "none";
        mainApp.style.display = "block";
    }
}

// Авто-вхід або показ логіну при завантаженні сторінки
firebase.auth().onAuthStateChanged((user) => {
    if (user) {
        console.log("Zalogowany jako:", user.email);
        showMainApp();
        loadExportedDataFromFirebase();
    } else {
        showLoginForm();
    }
});

// Збереження даних у Firebase після імпорту
function saveExportedDataToFirebase(dataArray) {
    const user = firebase.auth().currentUser;
    if (!user) {
        console.warn("Nie jesteś zalogowany – brak możliwości zapisu");
        return;
    }

    const uid = user.uid;
    const timestamp = new Date().toISOString();
    const ref = firebase.database().ref(`users/${uid}/lastExportedData`);

    ref.set({
        savedAt: timestamp,
        data: dataArray
    })
    .then(() => {
        console.log("Dane zostały zapisane w Firebase");
    })
    .catch((error) => {
        console.error("Błąd zapisu do Firebase:", error);
    });
}

// Завантаження даних після входу
function loadExportedDataFromFirebase() {
    const user = firebase.auth().currentUser;
    if (user) {
        const uid = user.uid;
        const ref = firebase.database().ref(`users/${uid}/lastExportedData`);

        ref.once("value")
            .then((snapshot) => {
                const saved = snapshot.val();
                if (saved && saved.data) {
                    console.log("Załadowano dane z Firebase:", saved);
                    renderImportedData(saved.data);
                } else {
                    console.log("Brak zapisanych danych w Firebase.");
                }
            })
            .catch((error) => {
                console.error("Błąd przy pobieraniu danych z Firebase:", error);
            });
    }
}
</script>


<script>
let editableSections = [];

function renderSectionEditor() {
    const container = document.createElement('div');
    container.style.margin = '20px';
    container.innerHTML = '<h3 style="color: white;">⚙️ Zarządzaj sekcjami:</h3>';

    editableSections.forEach((section, index) => {
        const input = document.createElement('input');
        input.type = 'text';
        input.value = section.title;
        input.style.marginRight = '10px';
        input.oninput = (e) => {
            section.title = e.target.value;
            document.getElementById(section.id + '-label').innerText = e.target.value;
            saveSectionsToFirebase();
        };
        container.appendChild(input);
    });

    const addBtn = document.createElement('button');
    addBtn.textContent = '➕ Dodaj nową sekcję';
    addBtn.onclick = () => {
        const newId = prompt('Podaj ID nowej sekcji (np. szkolenia):');
        const newTitle = prompt('Podaj nazwę sekcji (np. 📘 Szkolenia):');
        if (newId && newTitle) {
            editableSections.push({ id: newId, title: newTitle });
            createNewSection(newId, newTitle);
            saveSectionsToFirebase();
        }
    };
    container.appendChild(addBtn);

    document.body.appendChild(container);
}

function createNewSection(id, title) {
    const panel = document.createElement('div');
    panel.className = 'section';
    panel.style.border = '1px solid white';
    panel.style.padding = '10px';
    panel.style.margin = '10px';
    panel.style.color = 'white';
    panel.innerHTML = `
        <h3 id="${id}-label">${title}</h3>
        <div id="${id}-list"></div>
        <input type="text" id="${id}-input" placeholder="Nazwa..." />
        <button onclick="addToList('${id}')">➕ Dodaj</button>
    `;
    document.getElementById("main-app")?.appendChild(panel);
}

function addToList(id) {
    const input = document.getElementById(id + "-input");
    const list = document.getElementById(id + "-list");
    if (input && input.value) {
        const item = document.createElement("div");
        item.textContent = input.value;
        item.style.padding = "3px";
        list.appendChild(item);
        input.value = "";
    }
}

function saveSectionsToFirebase() {
    const user = firebase.auth().currentUser;
    if (!user) return;
    const ref = firebase.database().ref(\`users/\${user.uid}/customSections\`);
    ref.set(editableSections).then(() => {
        console.log("Sekcje zapisane w Firebase");
    });
}

function loadSectionsFromFirebase(callback) {
    const user = firebase.auth().currentUser;
    if (!user) return;
    const ref = firebase.database().ref(\`users/\${user.uid}/customSections\`);
    ref.once("value").then((snapshot) => {
        const data = snapshot.val();
        if (data && Array.isArray(data)) {
            editableSections = data;
        } else {
            editableSections = [
                { id: 'dzialy', title: '📁 Działy' },
                { id: 'stanowiska', title: '👷 Stanowiska' },
                { id: 'zmiany', title: '👥 Zmiany/Kierownicy' }
            ];
        }
        callback();
    });
}

firebase.auth().onAuthStateChanged((user) => {
    if (user) {
        loadSectionsFromFirebase(() => {
            renderSectionEditor();
            editableSections.forEach(section => {
                createNewSection(section.id, section.title);
            });
        });
    }
});
</script>

</body>
</html> 
<!-- Додай цей блок десь у розділі Ustawienia або внизу сторінки -->
<div class="settings-section" id="custom-section-container">
  <h3 class="settings-title">
    ➕ Create New Section
  </h3>
  <p style="color: var(--text-secondary); margin-bottom: 1rem;">
    Add custom categories like Buildings, Locations, Certifications, or any other data you need to track
  </p>
  <button class="btn btn-primary" onclick="showNewSectionPrompt()">
    ➕ Add New Section
  </button>
  <ul id="custom-sections-list" class="settings-list" style="margin-top: 1rem;"></ul>
</div>

<script>
let userId = null;

firebase.auth().onAuthStateChanged(user => {
  if (user) {
    userId = user.uid;
    listenForCustomSections();
  }
});

function showNewSectionPrompt() {
  const sectionName = prompt("Enter name of new section:");
  if (!sectionName) return;
  const newRef = firebase.database().ref(`sections/${userId}/customSections`).push();
  newRef.set({ name: sectionName, createdAt: Date.now() });
}

function listenForCustomSections() {
  firebase.database().ref(`sections/${userId}/customSections`).on('value', snapshot => {
    const data = snapshot.val() || {};
    renderCustomSections(data);
  });
}

function renderCustomSections(data) {
  const list = document.getElementById("custom-sections-list");
  list.innerHTML = "";
  Object.entries(data).forEach(([id, item]) => {
    const li = document.createElement("li");
    li.className = "settings-item";
    li.innerHTML = `
      <input type="text" value="${item.name}" onchange="updateCustomSection('${id}', this.value)" />
      <div class="settings-item-actions">
        <button class="btn-icon delete" onclick="deleteCustomSection('${id}')">🗑️</button>
      </div>
    `;
    list.appendChild(li);
  });
  refreshFiltersWithSections(data);
}

function updateCustomSection(id, newName) {
  if (!newName.trim()) return;
  firebase.database().ref(`sections/${userId}/customSections/${id}`).update({ name: newName });
}

function deleteCustomSection(id) {
  if (confirm("Are you sure you want to delete this section?")) {
    firebase.database().ref(`sections/${userId}/customSections/${id}`).remove();
  }
}

function refreshFiltersWithSections(data) {
  const filterSelect = document.getElementById("filter-department");
  if (!filterSelect) return;
  const current = filterSelect.value;
  filterSelect.innerHTML = '<option value="">Wszystkie działy</option>';
  Object.values(data).forEach(sec => {
    const opt = document.createElement("option");
    opt.value = sec.name;
    opt.textContent = sec.name;
    filterSelect.appendChild(opt);
  });
  filterSelect.value = current;
  applyFilters();
}
</script>
